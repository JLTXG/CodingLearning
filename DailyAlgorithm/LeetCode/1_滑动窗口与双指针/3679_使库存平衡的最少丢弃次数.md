æœ¬æ–‡é¢˜è§£åŸºäºä»¥ä¸‹åŸé¢˜æ•´ç†ï¼Œé¢˜æ„ç»æœ¬äººé‡æ–°è¡¨è¿°ï¼Œè§£é¢˜æ€è·¯ä¸ä»£ç å‡ä¸ºåŸåˆ›æˆ–è½¬è½½ï¼Œä»…ç”¨äºä¸ªäººå­¦ä¹ ä¸äº¤æµï¼Œå®Œæ•´é¢˜ç›®è¯·åŠ¡å¿…æŸ¥é˜…å®˜æ–¹åŸé¢˜é“¾æ¥ï¼š[3679. ä½¿åº“å­˜å¹³è¡¡çš„æœ€å°‘ä¸¢å¼ƒæ¬¡æ•° - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/minimum-discards-to-balance-inventory/description/)

>æ ‡ç­¾ï¼šæ•°ç»„  |  å“ˆå¸Œè¡¨  |  è®¡æ•°  |  æ»‘åŠ¨çª—å£  |  æ¨¡æ‹Ÿ

# ä¸€ã€é¢˜ç›®æè¿°

## **é—®é¢˜æ¦‚æ‹¬**

ç»™å®šä¸€ä¸ªç‰©å“åˆ°è¾¾åºåˆ— `arrivals`ï¼ˆ`arrivals[i]` è¡¨ç¤ºç¬¬ `i+1` å¤©åˆ°è¾¾çš„ç‰©å“ç±»å‹ï¼‰ã€‚ç³»ç»Ÿæœ‰ä¸€ä¸ªå¤§å°ä¸º `w` çš„æ»‘åŠ¨çª—å£ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š

- çª—å£è¦†ç›–ä»å½“å¤©å‘å‰è¿½æº¯æœ€å¤š `w` å¤©ï¼ˆåŒ…å«å½“å¤©ï¼‰ã€‚
- åœ¨**ä»»ä½•æ—¶åˆ»**çš„æ»‘åŠ¨çª—å£å†…ï¼Œè¢«ä¿ç•™çš„åˆ°è¾¾ç‰©å“ä¸­ï¼Œ**åŒä¸€ç§ç±»å‹**çš„ç‰©å“å‡ºç°æ¬¡æ•°ä¸èƒ½è¶…è¿‡ç»™å®šçš„æ­£æ•´æ•° `m`ã€‚
- ç‰©å“åœ¨åˆ°è¾¾å½“å¤©ï¼Œå¯ä»¥æ ¹æ®ä¸Šè¿°è§„åˆ™é€‰æ‹©**ä¿ç•™**æˆ–**ä¸¢å¼ƒ**ï¼ˆä¸¢å¼ƒå¿…é¡»åœ¨å½“å¤©å†³å®šï¼‰ã€‚
- å¦‚æœä¿ç•™å½“å¤©åˆ°è¾¾çš„ç‰©å“ï¼Œä¼šå¯¼è‡´å…¶åœ¨å½“å‰çª—å£å†…çš„å‡ºç°æ¬¡æ•°è¶…è¿‡ `m`ï¼Œåˆ™è¯¥ç‰©å“**å¿…é¡»**è¢«ä¸¢å¼ƒã€‚

ç›®æ ‡æ˜¯ï¼šåœ¨å§‹ç»ˆæ»¡è¶³çª—å£é™åˆ¶çš„å‰æä¸‹ï¼Œè®¡ç®—**æœ€å°‘éœ€è¦ä¸¢å¼ƒçš„ç‰©å“æ•°é‡**ã€‚

## **ç¤ºä¾‹æ ¸å¿ƒè¯´æ˜**

- **ç¤ºä¾‹1**ï¼š`arrivals = [1,2,1,3,1]`, `w = 4`, `m = 2`ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªé•¿åº¦ä¸º4çš„çª—å£å†…ï¼Œä»»ä½•ç±»å‹å‡ºç°æ¬¡æ•°å‡æœªè¶…è¿‡2æ¬¡ï¼Œå› æ­¤æ— éœ€ä¸¢å¼ƒä»»ä½•ç‰©å“ï¼Œç»“æœä¸º `0`ã€‚
- **ç¤ºä¾‹2**ï¼š`arrivals = [1,2,3,3,3,4]`, `w = 3`, `m = 2`ã€‚åœ¨ç¬¬5å¤©ï¼Œç‰©å“ `3` åˆ°è¾¾ï¼Œæ­¤æ—¶çª—å£ `[3,3,3]` å†…ç±»å‹ `3` å·²å‡ºç°2æ¬¡ï¼Œä¿ç•™æ–°ç‰©å“å°†å¯¼è‡´å…¶å‡ºç°3æ¬¡ï¼Œè¶…è¿‡é™åˆ¶ `m=2`ï¼Œå› æ­¤å¿…é¡»ä¸¢å¼ƒã€‚æœ€å°‘ä¸¢å¼ƒæ•°ä¸º `1`ã€‚

## **æ•°æ®èŒƒå›´**

- `1 <= arrivals.length <= 10^5`
- `1 <= arrivals[i] <= 10^5`
- `1 <= w <= arrivals.length`
- `1 <= m <= w`



# äºŒã€è§£é¢˜æ€è·¯\è§£é¢˜è¿‡ç¨‹

è¿™æ˜¯ä»Šå¤©åšçš„ç¬¬ä¸€é“â€œæ»‘åŠ¨çª—å£â€ç±»çš„é¢˜ç›®ï¼Œè¿™é“é¢˜å’Œå‰å¤©åšçš„é‚£é“â€”â€”[2841. å‡ ä¹å”¯ä¸€å­æ•°ç»„çš„æœ€å¤§å’Œ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/maximum-sum-of-almost-unique-subarray/)â€”â€”éœ€è¦ç”¨åˆ°å“ˆå¸Œè¡¨æ¥å¤„ç†å’Œæ›´æ–°ç­”æ¡ˆï¼Œæˆ‘èµ·åˆçš„æ€è·¯æ˜¯å¯¹çš„ï¼Œåœ¨å¾ªç¯ä¸­ï¼Œå…ˆåŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Œå¦‚æœçª—å£å¤§å°è¶…è¿‡é¢˜ç›®è¦æ±‚çš„`w`å€¼ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ”¶ç¼©å·¦è¾¹ç•Œäº†ï¼Œåé¢çš„ä»£ç å°±æ˜¯æ­£å¸¸çš„æ¨¡æ‹Ÿäº†ï¼Œå…ˆâ€œå°è¯•â€åŠ å…¥å½“å‰å…ƒç´ ï¼Œè®°å½•å½“å‰å…ƒç´ åœ¨å“ˆå¸Œè¡¨ä¸­çš„å·²ç»å­˜åœ¨çš„æ¬¡æ•°`count`ï¼Œå¦‚æœæ¬¡æ•°`count`å°äº`m`ï¼Œé‚£ä¹ˆå°±å¯ä»¥åŠ å…¥å“ˆå¸Œè¡¨`freq`ä¸­ï¼›å¦‚æœæ¬¡æ•°`count`å¤§äºç­‰äº`m`ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ­¤æ—¶éœ€è¦ä¸¢å¼ƒå½“å‰çš„å…ƒç´ ï¼Œä½†ä¸éœ€è¦æ›´æ–°`freq`ï¼Œéœ€è¦æ›´æ–°ç­”æ¡ˆâ€”â€”`result++`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
class Solution {
    public int minArrivalsToDiscard(int[] arrivals, int w, int m) {
        int result = 0, n = arrivals.length;
        Map<Integer, Integer> freq = new HashMap<>();
        for (int i = 0; i < n; i++) {
            // å¦‚æœçª—å£å¤§å°è¶…è¿‡ wï¼Œæ”¶ç¼©å·¦è¾¹ç•Œ
            if (i >= w) {
                int leftNum = arrivals[i - w];
                freq.put(leftNum, freq.get(leftNum) - 1);
                // å¦‚æœæ­¤æ—¶å·¦ç«¯ç‚¹çš„è®¡æ•°ä¸º 0ï¼Œé‚£ä¹ˆå°±éœ€è¦å‰”é™¤äº†
                if (freq.get(leftNum) == 0) {
                    freq.remove(leftNum);
                }
            }

            // å°è¯•åŠ å…¥å½“å‰å…ƒç´ 
            int current = arrivals[i];
            int count = freq.getOrDefault(current, 0);
            
            if (count < m) {
                // å¦‚æœæ­¤æ—¶è®¡æ•°å°äº mï¼Œåˆ™åŠ å…¥
                freq.put(current, count + 1);
            } else {
                // æ­¤æ—¶è¡¨åï¼Œå½“å‰å…ƒç´ å‡ºç°çš„æ¬¡æ•°å·²ç»å¤§äº m äº†ï¼Œæˆ‘ä»¬éœ€è¦ä¸¢å¼ƒï¼Œå¦å¤–ï¼Œéœ€è¦æ›´æ–°ç­”æ¡ˆäº†
                result++;
            }
        }
        return result;
    }
}
```

ä½†æ˜¯ï¼Œä¸Šè¿°ä»£ç æŠ¥é”™äº†ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š

```java
java.lang.NullPointerException: Cannot invoke "java.lang.Integer.intValue()" because the return value of "java.util.Map.get(Object)" is null at line 9, Solution.minArrivalsToDiscard at line 56, __DriverSolution__.__helper__ at line 92, __Driver__.main
```

å…·ä½“åŸå› çš„è¯ï¼Œæˆ‘æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼š`arrivals = [1, 1, 2, 1], w = 2, m = 1`

åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œè¿›å…¥å¾ªç¯ï¼š
- å½“`i = 0`æ—¶ï¼Œæ­¤æ—¶ä¸€åˆ‡ç…§å¸¸è¿›è¡Œï¼Œæ­¤æ—¶`freq = {1 : 1}`ï¼›
- å½“`i = 1`æ—¶ï¼Œ`1`çš„æ¬¡æ•°`count`å·²ç»ç­‰äº`m`äº†ï¼Œè¿™ä¸ªæ—¶å€™å¾—èˆå¼ƒ`1`ï¼Œå¯¹åº”`result++`ï¼Œä¸æ›´æ–°`freq`ï¼Œæ­¤æ—¶`freq = {1 : 1}`ï¼›ä¸åŠ å…¥
- å½“`i = 2`æ—¶ï¼Œæ­¤æ—¶çª—å£çš„é•¿åº¦å·²ç»è¶…è¿‡`w`äº†ï¼Œå³æ»¡è¶³`i >= w`ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ”¶ç¼©å·¦è¾¹ç•Œï¼Œæ³¨æ„ï¼Œ**é—®é¢˜å°±åœ¨è¿™é‡Œ**ï¼Œå½“æ”¶ç¼©å·¦è¾¹ç•Œæ—¶â€”â€”å³`arrivals[i - w]`â€”â€”å³`arrivals[2 - 2] = arrivals[0] = 1`â€”â€”å³ä¼šæ“ä½œ`freq.put(leftNum, freq.get(leftNum) - 1)`â€”â€”ä¼šå¯¼è‡´`freq = {1 : 1}`å˜æˆ`freq = {1 : 0}`ï¼Œç„¶åä¸Šè¿°äº†`freq`ä¸­çš„`1`ï¼›å¦å¤–ï¼Œè¿˜ä¼šåŠ å…¥`2`ï¼Œæœ€åæ›´æ–°äº†`freq`ï¼Œå³`freq = {2 : 1}`ï¼›
- å½“`i = 3`æ—¶ï¼Œæ­¤æ—¶çª—å£çš„é•¿åº¦ä¹Ÿå·²ç»è¶…è¿‡äº†`w`äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¹Ÿéœ€è¦æ”¶ç¼©å·¦è¾¹ç•Œï¼Œå³ç§»é™¤`i - w = 3 - 2 = 1`â†’`leftNum = arrivals[1] = 1`ï¼Œ**æ³¨æ„ï¼ŒæŠ¥é”™æ¥äº†**ï¼Œæˆ‘ä»¬åœ¨`i = 1`çš„æ—¶å€™ï¼Œæ²¡åŠ å…¥å¤šä½™çš„`1`ï¼Œåœ¨`i = 2`çš„æ—¶å€™ï¼Œåˆåˆ é™¤äº†å”¯ä¸€çš„`1`ï¼Œè¿™ä¸ªæ—¶å€™å†æ¬¡ç´¢å¼•`freq.get(1)`å°±ä¼šè¿”å›`null`ï¼Œç„¶å`null - 1`å°±è¿”å›`NullPointerException ğŸ’¥`â€”â€”**å¯¼è‡´æŠ¥é”™**ï¼

æ­£ç¡®çš„ä»£ç å¦‚ä¸‹ï¼ˆæœŸé—´è¿˜å‡ºç°äº†å…¶ä»–é”™è¯¯ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œåé¢è¿˜æ”¹å†™äº†å¥½å‡ æ¬¡ï¼Œä»£ç è¿˜æ˜¯æŠ¥é”™ï¼Œæœ€åè¿˜æ˜¯å‚è€ƒäº†çµç¥çš„ä»£ç â€”â€”[3679. ä½¿åº“å­˜å¹³è¡¡çš„æœ€å°‘ä¸¢å¼ƒæ¬¡æ•° - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/minimum-discards-to-balance-inventory/solutions/3781207/ding-chang-hua-dong-chuang-kou-pythonjav-2abe/)â€”â€”æ‰æ­£å¸¸é€šè¿‡ï¼Œè¿™é“é¢˜ç›®è¿˜éœ€è¦åšç¬¬äºŒéï¼‰ï¼š

```java
class Solution {
    public int minArrivalsToDiscard(int[] arrivals, int w, int m) {
        int result = 0, n = arrivals.length;
        Map<Integer, Integer> freq = new HashMap<>(); // ç»Ÿè®¡å½“å‰çª—å£ä¸­å„å…ƒç´ çš„æœ‰æ•ˆé¢‘æ¬¡

        for (int i = 0; i < n; i++) {
            int tmp = arrivals[i]; // å½“å‰å¤„ç†çš„å…ƒç´ 

            // æ£€æŸ¥å¦‚æœåŠ å…¥ tmpï¼Œæ˜¯å¦ä¼šè¶…è¿‡ m æ¬¡
            int count = freq.getOrDefault(tmp, 0);
            if (count == m) {
                // å·²è¾¾åˆ°ä¸Šé™ï¼Œå¿…é¡»ä¸¢å¼ƒ
                arrivals[i] = 0;      // æ ‡è®°ä¸ºæ— æ•ˆï¼ˆç”¨ 0 è¡¨ç¤ºä¸¢å¼ƒï¼‰
                result++;             // ä¸¢å¼ƒè®¡æ•° +1
            } else {
                // å¯ä»¥ä¿ç•™ï¼Œæ›´æ–°é¢‘æ¬¡
                freq.put(tmp, count + 1);
            }

            // è®¡ç®—çª—å£å·¦è¾¹ç•Œï¼ˆçª—å£ä¸º [left, i]ï¼Œé•¿åº¦ wï¼‰
            int left = i - w + 1;

            // å½“çª—å£å½¢æˆï¼ˆleft >= 0ï¼‰ï¼Œéœ€è¦ç§»é™¤ left ä½ç½®çš„å…ƒç´ 
            if (left >= 0) {
                // æ³¨æ„ï¼šå¦‚æœ arrivals[left] è¢«ä¸¢å¼ƒè¿‡ï¼Œå®ƒçš„å€¼æ˜¯ 0
                // freq.merge(key, delta, func) ç›¸å½“äºï¼š
                //   freq[key] = func(freq.get(key), delta)
                // è¿™é‡Œï¼šfreq[arrivals[left]] -= 1
                freq.merge(arrivals[left], -1, Integer::sum);

                // å¦‚æœé¢‘æ¬¡å‡åˆ° 0ï¼Œå¯ä»¥ removeï¼ˆä½† merge ä¸ä¼šè‡ªåŠ¨åˆ ï¼‰
                // åšä¸»æ²¡åˆ ï¼Œå¯èƒ½å¯¼è‡´ map è†¨èƒ€ï¼Œä½†ä¸å½±å“æ­£ç¡®æ€§
            }
        }
        return result;
    }
}
```



# ä¸‰ã€ä»£ç æ¼”ç¤º

## Javaä»£ç 

```Java
class Solution {
    public int minArrivalsToDiscard(int[] arrivals, int w, int m) {
        int result = 0, n = arrivals.length;
        Map<Integer, Integer> freq = new HashMap<>(); // ç»Ÿè®¡å½“å‰çª—å£ä¸­å„å…ƒç´ çš„æœ‰æ•ˆé¢‘æ¬¡

        for (int i = 0; i < n; i++) {
            int tmp = arrivals[i]; // å½“å‰å¤„ç†çš„å…ƒç´ 

            // æ£€æŸ¥å¦‚æœåŠ å…¥ tmpï¼Œæ˜¯å¦ä¼šè¶…è¿‡ m æ¬¡
            int count = freq.getOrDefault(tmp, 0);
            if (count == m) {
                // å·²è¾¾åˆ°ä¸Šé™ï¼Œå¿…é¡»ä¸¢å¼ƒ
                arrivals[i] = 0;      // æ ‡è®°ä¸ºæ— æ•ˆï¼ˆç”¨ 0 è¡¨ç¤ºä¸¢å¼ƒï¼‰
                result++;             // ä¸¢å¼ƒè®¡æ•° +1
            } else {
                // å¯ä»¥ä¿ç•™ï¼Œæ›´æ–°é¢‘æ¬¡
                freq.put(tmp, count + 1);
            }

            // è®¡ç®—çª—å£å·¦è¾¹ç•Œï¼ˆçª—å£ä¸º [left, i]ï¼Œé•¿åº¦ wï¼‰
            int left = i - w + 1;

            // å½“çª—å£å½¢æˆï¼ˆleft >= 0ï¼‰ï¼Œéœ€è¦ç§»é™¤ left ä½ç½®çš„å…ƒç´ 
            if (left >= 0) {
                // æ³¨æ„ï¼šå¦‚æœ arrivals[left] è¢«ä¸¢å¼ƒè¿‡ï¼Œå®ƒçš„å€¼æ˜¯ 0
                // freq.merge(key, delta, func) ç›¸å½“äºï¼š
                //   freq[key] = func(freq.get(key), delta)
                // è¿™é‡Œï¼šfreq[arrivals[left]] -= 1
                freq.merge(arrivals[left], -1, Integer::sum);

                // å¦‚æœé¢‘æ¬¡å‡åˆ° 0ï¼Œå¯ä»¥ removeï¼ˆä½† merge ä¸ä¼šè‡ªåŠ¨åˆ ï¼‰
                // åšä¸»æ²¡åˆ ï¼Œå¯èƒ½å¯¼è‡´ map è†¨èƒ€ï¼Œä½†ä¸å½±å“æ­£ç¡®æ€§
            }
        }
        return result;
    }
}
```



## Pythonä»£ç 

```Python
class Solution:
    def minArrivalsToDiscard(self, arrivals: List[int], w: int, m: int) -> int:
        result, n = 0, len(arrivals)
        freq = defaultdict(int)
        # è®°å½•æ¯ä¸ªä½ç½®æ˜¯å¦è¢«ä¸¢å¼ƒ
        discarded = [False] * n

        for i in range(n):
            tmp = arrivals[i]
            if freq[tmp] == m :
                # ä¸¢å¼ƒ
                discarded[i] = True
                result += 1
            else :
                # ä¿ç•™
                freq[tmp] += 1
            
            # ç§»é™¤å·¦è¾¹ç•Œ
            left = i - w + 1
            if left >= 0 and not discarded[left] :
                freq[arrivals[left]] -= 1
        
        return result
```



## C++ä»£ç 

```C++
class Solution {
public:
    int minArrivalsToDiscard(vector<int>& arrivals, int w, int m) {
        int result = 0, n = arrivals.size();
        unordered_map<int, int> freq;
        // è®°å½•å“ªäº›ä½ç½®è¢«ä¸¢å¼ƒ
        vector<bool> discarded(n, false);

        for (int i = 0; i < n; i++) {
            int tmp = arrivals[i];
            if (freq[tmp] == m) {
                // ä¸¢å¼ƒ
                discarded[i] = true;
                result++;
            } else {
                // ä¿ç•™
                freq[tmp]++;
            }

            // ç§»é™¤å·¦è¾¹ç•Œ
            int left = i - w + 1;
            if (left >= 0 && !discarded[left]) {
                freq[arrivals[left]]--;
            }
        }
        return result;
    }
};
```

![3679_ä½¿åº“å­˜å¹³è¡¡çš„æœ€å°‘ä¸¢å¼ƒæ¬¡æ•°_C++](https://gitee.com/lei-weijun/CodingLearning/raw/main/DailyAlgorithm/LeetCode/8_%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%8E%E5%8F%8C%E6%8C%87%E9%92%88/Images/3679_%E4%BD%BF%E5%BA%93%E5%AD%98%E5%B9%B3%E8%A1%A1%E7%9A%84%E6%9C%80%E5%B0%91%E4%B8%A2%E5%BC%83%E6%AC%A1%E6%95%B0_C++.png)