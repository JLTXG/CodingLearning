æœ¬æ–‡é¢˜è§£åŸºäºä»¥ä¸‹åŸé¢˜æ•´ç†ï¼Œé¢˜æ„ç»æœ¬äººé‡æ–°è¡¨è¿°ï¼Œè§£é¢˜æ€è·¯ä¸ä»£ç å‡ä¸ºåŸåˆ›æˆ–è½¬è½½ï¼Œä»…ç”¨äºä¸ªäººå­¦ä¹ ä¸äº¤æµï¼Œå®Œæ•´é¢˜ç›®è¯·åŠ¡å¿…æŸ¥é˜…å®˜æ–¹åŸé¢˜é“¾æ¥ï¼š[3510. ç§»é™¤æœ€å°æ•°å¯¹ä½¿æ•°ç»„æœ‰åº II - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/minimum-pair-removal-to-sort-array-ii/description/)

>æ ‡ç­¾ï¼šæ•°ç»„  |  å“ˆå¸Œè¡¨  |  é“¾è¡¨  |  åŒå‘é“¾è¡¨  |  æœ‰åºé›†åˆ  |  æ¨¡æ‹Ÿ  |  å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰

# ä¸€ã€é¢˜ç›®æè¿°

## **é—®é¢˜æ¦‚æ‹¬**

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œä½ å¯ä»¥åå¤æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

- åœ¨å½“å‰æ•°ç»„ä¸­ï¼Œæ‰¾åˆ°æ‰€æœ‰**ç›¸é‚»å…ƒç´ å¯¹**ã€‚
- ä»è¿™äº›ç›¸é‚»å¯¹ä¸­ï¼Œé€‰å‡º**å…ƒç´ å’Œæœ€å°**çš„ä¸€å¯¹ã€‚
- å¦‚æœå­˜åœ¨å¤šä¸ªå’Œæœ€å°çš„å¯¹ï¼Œåˆ™é€‰æ‹©**æœ€å·¦è¾¹**çš„é‚£ä¸€å¯¹ã€‚
- å°†é€‰ä¸­çš„è¿™ä¸€å¯¹ç›¸é‚»å…ƒç´ **æ›¿æ¢ä¸ºå®ƒä»¬çš„å’Œ**ï¼ˆå³åˆ é™¤è¿™ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨åŸä½ç½®æ’å…¥å®ƒä»¬çš„å’Œï¼‰ã€‚

ä½ çš„ç›®æ ‡æ˜¯ï¼Œé€šè¿‡æ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œæœ€ç»ˆä½¿æ•°ç»„å˜ä¸ºä¸€ä¸ª**éé€’å‡æ•°ç»„**ï¼ˆå³å¯¹äºæ•°ç»„ä¸­æ¯ä¸ªä½ç½®ï¼Œå…¶å…ƒç´ å€¼éƒ½å¤§äºæˆ–ç­‰äºå®ƒå‰ä¸€ä¸ªä½ç½®çš„å€¼ï¼‰ã€‚ä½ éœ€è¦è®¡ç®—å¹¶è¿”å›è¾¾æˆè¿™ä¸€ç›®æ ‡æ‰€éœ€çš„**æœ€å°‘æ“ä½œæ¬¡æ•°**ã€‚

## **ç¤ºä¾‹è¯´æ˜**

- **ç¤ºä¾‹1**ï¼š`nums = [5,2,3,1]`ã€‚
    - ç¬¬ä¸€æ¬¡æ“ä½œï¼šç›¸é‚»å¯¹ `(3,1)` çš„å’Œæœ€å°ï¼ˆä¸º4ï¼‰ï¼Œå°†å…¶åˆå¹¶ï¼Œæ•°ç»„å˜ä¸º `[5,2,4]`ã€‚
    - ç¬¬äºŒæ¬¡æ“ä½œï¼šç›¸é‚»å¯¹ `(2,4)` çš„å’Œæœ€å°ï¼ˆä¸º6ï¼‰ï¼Œå°†å…¶åˆå¹¶ï¼Œæ•°ç»„å˜ä¸º `[5,6]`ã€‚æ­¤æ—¶æ•°ç»„å·²æ˜¯éé€’å‡çš„ã€‚å…±éœ€ **2** æ¬¡æ“ä½œã€‚
- **ç¤ºä¾‹2**ï¼š`nums = [1,2,2]`ã€‚æ•°ç»„æœ¬èº«å°±æ˜¯éé€’å‡çš„ï¼Œå› æ­¤ä¸éœ€è¦ä»»ä½•æ“ä½œï¼Œç­”æ¡ˆä¸º **0**ã€‚

## **æ•°æ®èŒƒå›´**

- æ•°ç»„é•¿åº¦åœ¨ `1` åˆ° `10^5` ä¹‹é—´ã€‚
- æ•°ç»„å…ƒç´ å€¼åœ¨ `-10^9` åˆ° `10^9` ä¹‹é—´ã€‚



# äºŒã€è§£é¢˜æ€è·¯\è§£é¢˜è¿‡ç¨‹

è¿™é“é¢˜ç›®æ˜¯åŠ›æ‰£ç¬¬3507é“é¢˜ç›®çš„ä¸€ä¸ªè¿›é˜¶ç‰ˆï¼ŒåŸºæœ¬ä¸Šé¢˜æ„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯æ•°æ®èŒƒå›´è¿™ä¸€å—ï¼Œæœ¬é¢˜æ¯”åŠ›æ‰£ç¬¬3507é“é¢˜ç›®â€”â€”[3507. ç§»é™¤æœ€å°æ•°å¯¹ä½¿æ•°ç»„æœ‰åº I - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/minimum-pair-removal-to-sort-array-i/description/?envType=daily-question&envId=2026-01-22)â€”â€”çš„æ•°æ®èŒƒå›´â€œæ›´å¤§â€ï¼Œè‡³äºæœ¬é¢˜çš„æ€è·¯å¯ä»¥å‚è€ƒåŠ›æ‰£ç¬¬3507é“é¢˜ç›®ç¬”è®°ä¸­çš„ç¬¬äºŒç§æ€è·¯â€”â€”ä¸¤ä¸ªæœ‰åºé›†åˆï¼

## ä¸¤ä¸ªæœ‰åºé›†åˆ

### âœ… å‰ç½®çŸ¥è¯†è¯´æ˜

- `from sortedcontainers import SortedList`ï¼šç¬¬ä¸‰æ–¹åº“ï¼Œæä¾›ç±»ä¼¼ C++ `multiset` çš„åŠŸèƒ½ï¼Œæ”¯æŒ O(log n) æ’å…¥ã€åˆ é™¤ã€æŒ‰åºè®¿é—®ã€‚
- `pairwise(nums)`ï¼ˆPython 3.10+ï¼‰ï¼šè¿”å› `(nums[0], nums[1]), (nums[1], nums[2]), ...`
- `idx`ï¼šè®°å½•å½“å‰**ä»ç„¶å­˜æ´»çš„åŸå§‹ä¸‹æ ‡**ï¼ˆå› ä¸ºåˆå¹¶åæŸäº›ä½ç½®è¢«â€œé€»è¾‘åˆ é™¤â€ï¼‰
- `nums[i]` åœ¨åˆå¹¶åä¼šè¢«æ›´æ–°ä¸ºæ–°çš„å€¼ï¼ˆä»£è¡¨è¯¥â€œå—â€çš„æ€»å’Œï¼‰

---

### ğŸ” é€è¡Œå¸¦æ³¨é‡Šè§£æ

```python
from typing import List
from sortedcontainers import SortedList
from itertools import pairwise

class Solution:
    def minimumPairRemoval(self, nums: List[int]) -> int:
        # sl: å­˜å‚¨æ‰€æœ‰ã€Œå½“å‰ç›¸é‚»å¯¹ã€çš„ (å’Œ, å·¦è¾¹å…ƒç´ çš„åŸå§‹ä¸‹æ ‡)
        # ç”¨ SortedList è‡ªåŠ¨æŒ‰å’Œä»å°åˆ°å¤§æ’åºï¼Œæ–¹ä¾¿æ¯æ¬¡å–æœ€å°å’Œçš„å¯¹
        sl = SortedList()  # (ç›¸é‚»å…ƒç´ å’Œ, å·¦è¾¹é‚£ä¸ªæ•°çš„ä¸‹æ ‡)

        # idx: å½“å‰ä»å­˜åœ¨çš„åŸå§‹ä¸‹æ ‡ï¼ˆæŒ‰é¡ºåºï¼‰ï¼Œç”¨äºå¿«é€Ÿå®šä½å‰åé‚»å±…
        # åˆå§‹æ—¶æ‰€æœ‰ä¸‹æ ‡ [0, 1, 2, ..., n-1] éƒ½å­˜åœ¨
        idx = SortedList(range(len(nums)))

        # dec: å½“å‰æ•°ç»„ä¸­ã€Œé€’å‡ç›¸é‚»å¯¹ã€çš„æ•°é‡ï¼ˆå³ nums[i] > nums[i+1] çš„ä¸ªæ•°ï¼‰
        # åªè¦ dec > 0ï¼Œè¯´æ˜è¿˜æ²¡å˜æˆéé€’å‡ï¼Œéœ€è¦ç»§ç»­åˆå¹¶
        dec = 0

        # åˆå§‹åŒ–ï¼šéå†æ‰€æœ‰åˆå§‹ç›¸é‚»å¯¹
        for i, (x, y) in enumerate(pairwise(nums)):
            if x > y:
                dec += 1  # å‘ç°ä¸€ä¸ªé€’å‡å¯¹
            sl.add((x + y, i))  # è®°å½•è¿™å¯¹çš„å’Œï¼Œå·¦ä¸‹æ ‡æ˜¯ i

        ans = 0  # æ“ä½œæ¬¡æ•°

        # åªè¦è¿˜æœ‰é€’å‡å¯¹ï¼Œå°±ç»§ç»­åˆå¹¶
        while dec > 0:
            ans += 1

            # å–å‡ºã€Œå’Œæœ€å°ã€çš„ç›¸é‚»å¯¹ï¼ˆè´ªå¿ƒç­–ç•¥ï¼‰
            s, i = sl.pop(0)  # s = nums[i] + nums[i+1], i æ˜¯å·¦è¾¹å…ƒç´ çš„åŸå§‹ä¸‹æ ‡

            # åœ¨ idx ä¸­æ‰¾åˆ° i çš„ä½ç½® kï¼ˆå³ i æ˜¯å½“å‰å­˜æ´»å…ƒç´ ä¸­çš„ç¬¬ k ä¸ªï¼‰
            k = idx.bisect_left(i)  # å› ä¸º idx æ˜¯æœ‰åºçš„ï¼Œå¯ç”¨äºŒåˆ†æŸ¥æ‰¾

            # æ‰¾åˆ° i çš„ä¸‹ä¸€ä¸ªå­˜æ´»ä¸‹æ ‡ï¼ˆå³åŸæ•°ç»„ä¸­ç´§æŒ¨ç€çš„å³è¾¹é‚»å±…ï¼‰
            nxt = idx[k + 1]  # è¿™å°±æ˜¯æˆ‘ä»¬è¦åˆå¹¶æ‰çš„å³è¾¹å…ƒç´ çš„åŸå§‹ä¸‹æ ‡

            # ã€æ—§æ•°æ®æ¸…ç†ã€‘æ£€æŸ¥ (i, nxt) è¿™å¯¹æ˜¯å¦æ˜¯é€’å‡çš„
            if nums[i] > nums[nxt]:
                dec -= 1  # åˆå¹¶åè¿™å¯¹æ¶ˆå¤±ï¼Œæ‰€ä»¥é€’å‡å¯¹æ•°é‡å‡ 1

            # ã€å¤„ç†å·¦è¾¹é‚»å±…ã€‘ï¼šå¦‚æœ i ä¸æ˜¯æœ€å·¦è¾¹çš„å…ƒç´ 
            if k > 0:
                pre = idx[k - 1]  # pre æ˜¯ i å·¦è¾¹çš„å­˜æ´»ä¸‹æ ‡

                # 1. ç§»é™¤æ—§çš„ (pre, i) å¯¹çš„å½±å“
                if nums[pre] > nums[i]:
                    dec -= 1  # è¿™å¯¹å³å°†è¢«ç ´åï¼Œä¸å†æ˜¯ç›¸é‚»å¯¹

                # 2. æ·»åŠ æ–°çš„ (pre, new_i) å¯¹çš„å½±å“ï¼ˆnew_i çš„å€¼æ˜¯ sï¼‰
                if nums[pre] > s:
                    dec += 1  # æ–°çš„ç›¸é‚»å¯¹æ˜¯é€’å‡çš„

                # 3. æ›´æ–° slï¼šåˆ é™¤æ—§çš„ (pre + i)ï¼ŒåŠ å…¥æ–°çš„ (pre + s)
                sl.remove((nums[pre] + nums[i], pre))
                sl.add((nums[pre] + s, pre))

            # ã€å¤„ç†å³è¾¹é‚»å±…ã€‘ï¼šå¦‚æœ nxt ä¸æ˜¯æœ€å³è¾¹çš„å…ƒç´ 
            if k + 2 < len(idx):  # è¯´æ˜ nxt æœ‰å³é‚»å±…
                nxt2 = idx[k + 2]  # nxt çš„ä¸‹ä¸€ä¸ªå­˜æ´»ä¸‹æ ‡

                # 1. ç§»é™¤æ—§çš„ (nxt, nxt2) å¯¹çš„å½±å“
                if nums[nxt] > nums[nxt2]:
                    dec -= 1

                # 2. æ·»åŠ æ–°çš„ (new_i, nxt2) å¯¹çš„å½±å“ï¼ˆnew_i = sï¼‰
                if s > nums[nxt2]:
                    dec += 1

                # 3. æ›´æ–° slï¼šåˆ é™¤æ—§çš„ (nxt + nxt2)ï¼ŒåŠ å…¥æ–°çš„ (s + nxt2)
                # æ³¨æ„ï¼šæ–°å¯¹çš„å·¦ä¸‹æ ‡æ˜¯ iï¼ˆå› ä¸º nxt è¢«åˆ äº†ï¼Œi ç°åœ¨ä»£è¡¨åˆå¹¶åçš„å—ï¼‰
                sl.remove((nums[nxt] + nums[nxt2], nxt))
                sl.add((s + nums[nxt2], i))  # å·¦ä¸‹æ ‡ç”¨ i

            # ã€å®é™…åˆå¹¶ã€‘ï¼šæŠŠå³è¾¹å…ƒç´ åŠ åˆ°å·¦è¾¹
            nums[i] = s  # ç°åœ¨ nums[i] ä»£è¡¨åˆå¹¶åçš„å€¼

            # ã€é€»è¾‘åˆ é™¤ã€‘ï¼šä»å­˜æ´»ä¸‹æ ‡ä¸­ç§»é™¤ nxtï¼ˆå®ƒè¢«åˆå¹¶è¿› i äº†ï¼‰
            idx.remove(nxt)

        return ans
```

---

### ğŸ§  æ ¸å¿ƒæ€æƒ³æ€»ç»“

#### 1. **è´ªå¿ƒç­–ç•¥**

> æ¯æ¬¡é€‰æ‹©**ç›¸é‚»å…ƒç´ å’Œæœ€å°çš„ä¸€å¯¹**è¿›è¡Œåˆå¹¶ã€‚

ä¸ºä»€ä¹ˆï¼Ÿ

- åˆå¹¶å°çš„æ•°ï¼Œæœ‰åŠ©äºå‡å°‘åç»­å‡ºç°â€œå¤§æ•° > å°æ•°â€çš„é€’å‡æƒ…å†µã€‚
- ç›´è§‰ä¸Šï¼Œåˆå¹¶å°çš„æ•°ä¼šè®©æ•´ä½“æ›´â€œå¹³æ»‘â€ï¼Œæ›´å¿«è¾¾åˆ°éé€’å‡ã€‚

#### 2. **æ‡’åˆ é™¤ + ä¸‹æ ‡è¿½è¸ª**

- ä¸çœŸæ­£ç§»åŠ¨æ•°ç»„ï¼Œè€Œæ˜¯ç”¨ `idx` è®°å½•å“ªäº›åŸå§‹ä¸‹æ ‡è¿˜â€œå­˜æ´»â€ã€‚
- åˆå¹¶æ—¶ï¼Œåªæ›´æ–° `nums[i]` çš„å€¼ï¼Œå¹¶ä» `idx` ä¸­åˆ æ‰è¢«åˆå¹¶çš„ `nxt`ã€‚
- è¿™æ ·é¿å…äº† O(n) çš„æ•°ç»„ç§»åŠ¨ï¼Œæå‡æ•ˆç‡ã€‚

#### 3. **åŠ¨æ€ç»´æŠ¤ä¸¤ä¸ªå…³é”®ä¿¡æ¯**

| ä¿¡æ¯                 | å¦‚ä½•ç»´æŠ¤                                                     |
| -------------------- | ------------------------------------------------------------ |
| **æœ€å°ç›¸é‚»å’Œ**       | ç”¨ `SortedList sl` å­˜ `(sum, left_index)`ï¼Œè‡ªåŠ¨æ’åº          |
| **é€’å‡å¯¹æ•°é‡ `dec`** | æ¯æ¬¡åˆå¹¶æ—¶ï¼Œç²¾ç¡®å¢å‡å—å½±å“çš„ç›¸é‚»å¯¹ï¼ˆæœ€å¤š3å¯¹ï¼šå·¦-ä¸­ã€ä¸­-å³ã€å³-å³å³ï¼‰ |

#### 4. **å±€éƒ¨æ›´æ–°ï¼Œå…¨å±€ä¸€è‡´**

- æ¯æ¬¡åªä¿®æ”¹**å—å½±å“çš„å±€éƒ¨åŒºåŸŸ**ï¼ˆæœ€å¤šæ¶‰åŠ3ä¸ªç›¸é‚»å¯¹ï¼‰ï¼š
    - å·¦è¾¹é‚»å±…ä¸å½“å‰å—
    - å½“å‰å—ä¸å³è¾¹é‚»å±…ï¼ˆå·²åˆ ï¼‰
    - å³è¾¹é‚»å±…ä¸å®ƒçš„å³è¾¹
- å…¶ä½™éƒ¨åˆ†ä¸å—å½±å“ï¼Œæ— éœ€é‡æ–°æ‰«ææ•´ä¸ªæ•°ç»„ã€‚

---

### ğŸ’¡ ä¸¾ä¸ªå°ä¾‹å­å¸®åŠ©ç†è§£

å‡è®¾ `nums = [5, 3, 1, 2]`

- åˆå§‹ç›¸é‚»å¯¹ï¼š(5,3)â†’å’Œ8, (3,1)â†’å’Œ4, (1,2)â†’å’Œ3
- `sl =` â†’ å…ˆåˆå¹¶ (1,2)
- åˆå¹¶å `nums[2] = 3`ï¼Œæ•°ç»„é€»è¾‘ä¸Šå˜ä¸º `[5,3,3]`
- æ›´æ–° `dec` å’Œ `sl`â€¦â€¦
- ç»§ç»­ç›´åˆ°éé€’å‡ã€‚

---

### âœ… æ€»ç»“

è¿™æ®µä»£ç çš„ç²¾å¦™ä¹‹å¤„åœ¨äºï¼š

> **ç”¨â€œåŸå§‹ä¸‹æ ‡ + åŠ¨æ€ç»´æŠ¤ç›¸é‚»å…³ç³»â€çš„æ–¹å¼ï¼Œå°†ä¸€ä¸ªçœ‹ä¼¼éœ€è¦é¢‘ç¹ä¿®æ”¹æ•°ç»„çš„é—®é¢˜ï¼Œè½¬åŒ–ä¸ºå¯¹æœ‰åºé›†åˆçš„é«˜æ•ˆæ“ä½œã€‚**

å®ƒä½“ç°äº†ç®—æ³•ç«èµ›ä¸­å¸¸è§çš„æŠ€å·§ï¼š

- **è´ªå¿ƒé€‰æ‹©**
- **æ‡’æƒ°æ›´æ–°ï¼ˆlazy updateï¼‰**
- **ç”¨æ•°æ®ç»“æ„ï¼ˆSortedListï¼‰æ›¿ä»£æš´åŠ›**



# ä¸‰ã€ä»£ç æ¼”ç¤º

## Javaä»£ç 

```Java
class Solution {
    static class Pair implements Comparable<Pair> {
        long sum;
        int idx;

        Pair(long sum, int idx) {
            this.sum = sum;
            this.idx = idx;
        }

        @Override
        public int compareTo(Pair other) {
            if (this.sum != other.sum) {
                return Long.compare(this.sum, other.sum);
            }
            return Integer.compare(this.idx, other.idx);
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (!(o instanceof Pair)) return false;
            Pair p = (Pair) o;
            return sum == p.sum && idx == p.idx;
        }

        @Override
        public int hashCode() {
            return Objects.hash(sum, idx);
        }
    }

    public int minimumPairRemoval(int[] nums) {
        int n = nums.length;
        if (n <= 1) return 0;

        // å­˜æ´»ä¸‹æ ‡
        TreeSet<Integer> idx = new TreeSet<>();
        for (int i = 0; i < n; i++) {
            idx.add(i);
        }

        // å½“å‰å€¼æ•°ç»„ï¼ˆç”¨ long é˜²æ­¢æº¢å‡ºï¼‰
        long[] a = new long[n];
        for (int i = 0; i < n; i++) {
            a[i] = nums[i];
        }

        // æ‰€æœ‰ç›¸é‚»å¯¹ (sum, left_index)
        TreeSet<Pair> pairs = new TreeSet<>();

        // åˆå§‹åŒ– dec å’Œ pairs
        int dec = 0;
        for (int i = 0; i + 1 < n; i++) {
            if (a[i] > a[i + 1]) {
                dec++;
            }
            pairs.add(new Pair(a[i] + a[i + 1], i));
        }

        int ans = 0;
        while (dec > 0) {
            // === è¿‡æ»¤é™ˆæ—§æ•°æ® ===
            Pair candidate = null;
            while (!pairs.isEmpty()) {
                Pair p = pairs.first();
                int i = p.idx;
                long s = p.sum;

                // æ£€æŸ¥ i æ˜¯å¦è¿˜å­˜æ´»
                if (!idx.contains(i)) {
                    pairs.pollFirst();
                    continue;
                }

                // æ£€æŸ¥ i æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ 
                Integer nxt = idx.higher(i);
                if (nxt == null) {
                    pairs.pollFirst();
                    continue;
                }

                // æ£€æŸ¥ sum æ˜¯å¦ä»ç„¶æœ‰æ•ˆ
                if (s != a[i] + a[nxt]) {
                    pairs.pollFirst();
                    continue;
                }

                candidate = p;
                break;
            }

            if (candidate == null) break; // å®‰å…¨å…œåº•

            pairs.pollFirst(); // ç§»é™¤æœ‰æ•ˆ pair
            ans++;

            int i = candidate.idx;
            long s = candidate.sum;
            Integer nxt = idx.higher(i); // ä¸€å®šä¸ä¸º nullï¼ˆå·²éªŒè¯ï¼‰

            // ç§»é™¤ (i, nxt) çš„å½±å“
            if (a[i] > a[nxt]) {
                dec--;
            }

            // === å¤„ç†å·¦é‚»å±… ===
            Integer pre = idx.lower(i);
            if (pre != null) {
                // ç§»é™¤æ—§çš„ (pre, i)
                if (a[pre] > a[i]) dec--;
                pairs.remove(new Pair(a[pre] + a[i], pre));

                // æ·»åŠ æ–°çš„ (pre, new_i = s)
                if (a[pre] > s) dec++;
                pairs.add(new Pair(a[pre] + s, pre));
            }

            // === å¤„ç†å³é‚»å±… ===
            Integer nxt2 = idx.higher(nxt);
            if (nxt2 != null) {
                // ç§»é™¤æ—§çš„ (nxt, nxt2)
                if (a[nxt] > a[nxt2]) dec--;
                pairs.remove(new Pair(a[nxt] + a[nxt2], nxt));

                // æ·»åŠ æ–°çš„ (new_i = s, nxt2)ï¼Œå·¦ä¸‹æ ‡æ˜¯ i
                if (s > a[nxt2]) dec++;
                pairs.add(new Pair(s + a[nxt2], i));
            }

            // åˆå¹¶ï¼šæ›´æ–° a[i]
            a[i] = s;

            // åˆ é™¤ nxt
            idx.remove(nxt);
        }

        return ans;
    }
}
```



## Pythonä»£ç 

```Python
class Solution:
    def minimumPairRemoval(self, nums: List[int]) -> int:
        # slï¼šå­˜å‚¨æ‰€æœ‰ [å½“å‰ç›¸é‚»å¯¹] çš„ (å’Œï¼Œå·¦è¾¹å…ƒç´ çš„åŸå§‹ä¸‹æ ‡)
        # ç”¨ SortedList è‡ªåŠ¨æŒ‰å’Œä»å°åˆ°å¤§æ’åºï¼Œæ–¹ä¾¿æ¯æ¬¡å–æœ€å°å’Œçš„å¯¹
        sl = SortedList()  # (ç›¸é‚»å…ƒç´ å’Œï¼Œå·¦è¾¹é‚£ä¸ªæ•°çš„ä¸‹æ ‡)

        # idsï¼šå½“å‰ä»å­˜åœ¨çš„åŸå§‹ä¸‹æ ‡ï¼ˆæŒ‰é¡ºåºï¼‰ï¼Œç”¨äºå¿«é€Ÿå®šä½å‰åé‚»å±…
        # åˆå§‹æ—¶æ‰€æœ‰ä¸‹æ ‡ [0, 1, 2, ..., n - 1] éƒ½å­˜åœ¨
        idx = SortedList(range(len(nums)))

        # decï¼šå½“å‰æ•°ç»„ä¸­ [é€’å‡ç›¸é‚»å¯¹] çš„æ•°é‡ï¼ˆå³ nums[i] > nums[i + 1] çš„ä¸ªæ•°ï¼‰
        # åªè¦ dec > 0ï¼Œè¯´æ˜è¿˜æ²¡å˜æˆéé€’å‡ï¼Œéœ€è¦ç»§ç»­åˆå¹¶
        dec = 0

        # åˆå§‹åŒ–ï¼šéå†æ‰€æœ‰åˆå§‹ç›¸é‚»å¯¹
        for i, (x, y) in enumerate(pairwise(nums)):
            if x > y :
                dec += 1  # å‘ç°ä¸€ä¸ªé€’å‡å¯¹
            sl.add((x + y, i))  # è®°å½•è¿™å¯¹çš„å’Œï¼Œå·¦ä¸‹æ ‡æ˜¯ i
        
        ans = 0  # æ“ä½œæ¬¡æ•°

        # åªè¦è¿˜æœ‰é€’å‡å¯¹ï¼Œå°±ç»§ç»­åˆå¹¶
        while dec > 0 :
            ans += 1

            # å–å‡º [å’Œæœ€å°] çš„ç›¸é‚»å¯¹ï¼ˆè´ªå¿ƒç­–ç•¥ï¼‰
            s, i = sl.pop(0)  # s = nums[i] + nums[i + 1]ï¼Œi æ˜¯å·¦è¾¹å…ƒç´ çš„åŸå§‹ä¸‹æ ‡

            # åœ¨ idx ä¸­æ‰¾åˆ° i çš„ä½ç½® kï¼ˆå³ i æ˜¯å½“å‰å­˜æ´»å…ƒç´ ä¸­çš„ç¬¬ k ä¸ªï¼‰
            k = idx.bisect_left(i)  # å› ä¸º idx æ˜¯æœ‰åºçš„ï¼Œå¯ç”¨äºŒåˆ†æŸ¥æ‰¾

            # æ‰¾åˆ° i çš„ä¸‹ä¸€ä¸ªå­˜æ´»ä¸‹æ ‡ï¼ˆå³åŸæ•°ç»„ä¸­ç´§æŒ¨ç€çš„å³è¾¹é‚»å±…ï¼‰
            nxt = idx[k + 1]  # è¿™å°±æ˜¯æˆ‘ä»¬è¦åˆå¹¶æ‰çš„å³è¾¹å…ƒç´ çš„åŸå§‹ä¸‹æ ‡

            # ã€æ—§æ•°æ®æ¸…ç†ã€‘æ£€æŸ¥ (i, nxt) è¿™å¯¹æ˜¯å¦æ˜¯é€’å‡çš„
            if nums[i] > nums[nxt] :
                dec -= 1  # åˆå¹¶åè¿™å¯¹æ¶ˆå¤±ï¼Œæ‰€ä»¥é€’å‡å¯¹æ•°é‡å‡ 1

            # ã€å¤„ç†å·¦è¾¹é‚»å±…ã€‘ï¼šå¦‚æœ i ä¸æ˜¯æœ€å·¦è¾¹çš„å…ƒç´ 
            if k > 0 :
                pre = idx[k - 1]  # pre æ˜¯ i å·¦è¾¹çš„å­˜æ´»ä¸‹æ ‡

                # 1. ç§»é™¤æ—§çš„ (pre, i) å¯¹çš„å½±å“
                if nums[pre] > nums[i] :
                    dec -= 1  # è¿™å¯¹å³å°†è¢«ç ´åï¼Œä¸å†æ˜¯ç›¸é‚»å¯¹

                # 2. æ·»åŠ æ–°çš„ (pre, new_i) å¯¹çš„å½±å“ï¼ˆnew_i çš„å€¼æ˜¯ sï¼‰
                if nums[pre] > s :
                    dec += 1  # æ–°çš„ç›¸é‚»å¯¹æ˜¯é€’å‡çš„
                
                # 3. æ›´æ–° slï¼šåˆ é™¤æ—§çš„ (pre + i)ï¼ŒåŠ å…¥æ–°çš„ (pre + s)
                sl.remove((nums[pre] + nums[i], pre))
                sl.add((nums[pre] + s, pre))

            # ã€å¤„ç†å³è¾¹é‚»å±…ã€‘ï¼šå¦‚æœ nxt ä¸æ˜¯æœ€å³è¾¹çš„å…ƒç´ 
            if k + 2 < len(idx):  # è¯´æ˜ nxt æœ‰å³é‚»å±…
                nxt2 = idx[k + 2]  # nxt çš„ä¸‹ä¸€ä¸ªå­˜æ´»ä¸‹æ ‡

                # 1. ç§»é™¤æ—§çš„ (nxt, nxt2) å¯¹çš„å½±å“
                if nums[nxt] > nums[nxt2] :
                    dec -= 1
                
                # 2. æ·»åŠ æ–°çš„ (new_i, nxt2) å¯¹çš„å½±å“ï¼ˆnew_i = sï¼‰
                if s > nums[nxt2] :
                    dec += 1
                
                # 3. æ›´æ–° slï¼šåˆ é™¤æ—§çš„ (nxt + nxt2)ï¼ŒåŠ å…¥æ–°çš„ (s + nxt2)
                # æ³¨æ„ï¼šæ–°å¯¹çš„å·¦ä¸‹æ ‡æ˜¯ i ï¼ˆå› ä¸º nxt è¢«åˆ é™¤äº†ï¼Œi ç°åœ¨ä»£è¡¨åˆå¹¶åçš„å—ï¼‰
                sl.remove((nums[nxt] + nums[nxt2], nxt))
                sl.add((s + nums[nxt2], i))  # å·¦ä¸‹æ ‡ç”¨ i
            
            # ã€å®é™…åˆå¹¶ã€‘ï¼šæŠŠå³è¾¹å…ƒç´ åŠ åˆ°å·¦è¾¹
            nums[i] = s  # ç°åœ¨ nums[i] ä»£è¡¨åˆå¹¶åçš„å€¼

            # ã€é€»è¾‘åˆ é™¤ã€‘ï¼šä»å­˜æ´»ä¸‹æ ‡ä¸­ç§»é™¤ nxtï¼ˆå®ƒè¢«åˆå¹¶è¿› i äº†ï¼‰
            idx.remove(nxt)
        
        return ans
```

![3510_ç§»é™¤æœ€å°æ•°å¯¹ä½¿æ•°ç»„æœ‰åº II_Python]()

## C++ä»£ç 

```C++
class Solution {
public:
    int minimumPairRemoval(vector<int>& nums) {
        int n = nums.size();
        if (n <= 1) return 0;

        set<pair<long long, int>> pairs;
        set<int> idx;
        vector<long long> a(nums.begin(), nums.end());

        // åˆå§‹åŒ–
        for (int i = 0; i < n; ++i) idx.insert(i);
        int dec = 0;
        for (int i = 0; i + 1 < n; ++i) {
            if (a[i] > a[i + 1]) dec++;
            pairs.emplace(a[i] + a[i + 1], i);
        }

        int ans = 0;
        while (dec > 0) {
            // è¿‡æ»¤é™ˆæ—§æ•°æ®
            while (!pairs.empty()) {
                auto [s, i] = *pairs.begin();
                if (idx.find(i) == idx.end()) {
                    pairs.erase(pairs.begin());
                    continue;
                }
                auto it = idx.find(i);
                auto nxt_it = next(it);
                if (nxt_it == idx.end()) {
                    pairs.erase(pairs.begin());
                    continue;
                }
                int nxt = *nxt_it;
                if (s != a[i] + a[nxt]) { // å’Œå·²è¿‡æœŸ
                    pairs.erase(pairs.begin());
                    continue;
                }
                break;
            }

            if (pairs.empty()) break; // å®‰å…¨å…œåº•

            auto [s, i] = *pairs.begin();
            pairs.erase(pairs.begin());
            ans++;

            auto it = idx.find(i);
            auto nxt_it = next(it);
            int nxt = *nxt_it;

            // ç§»é™¤ (i, nxt) çš„å½±å“
            if (a[i] > a[nxt]) dec--;

            // å·¦é‚»å±…
            if (it != idx.begin()) {
                auto pre_it = prev(it);
                int pre = *pre_it;
                if (a[pre] > a[i]) dec--;
                pairs.erase({a[pre] + a[i], pre}); // å®‰å…¨ï¼šè¿™ä¸ª pair ä¸€å®šå­˜åœ¨ï¼ˆåˆšè¢«éªŒè¯è¿‡ï¼‰
                if (a[pre] > s) dec++;
                pairs.emplace(a[pre] + s, pre);
            }

            // å³é‚»å±…
            auto nxt2_it = next(nxt_it);
            if (nxt2_it != idx.end()) {
                int nxt2 = *nxt2_it;
                if (a[nxt] > a[nxt2]) dec--;
                pairs.erase({a[nxt] + a[nxt2], nxt});
                if (s > a[nxt2]) dec++;
                pairs.emplace(s + a[nxt2], i);
            }

            a[i] = s;
            idx.erase(nxt_it);
        }
        return ans;
    }
};
```

