[840. 矩阵中的幻方 - 力扣（LeetCode）](https://leetcode.cn/problems/magic-squares-in-grid/description/?envType=daily-question&envId=2025-12-30)

>标签：数组  |  哈希表  |  数学  |  矩阵

# 一、题目描述

`3 x 3` 的幻方是一个填充有 **从 `1` 到 `9`** 的不同数字的 `3 x 3` 矩阵，其中每行，每列以及两条对角线上的各数之和都相等。

给定一个由整数组成的`row x col` 的 `grid`，其中有多少个 `3 × 3` 的 “幻方” 子矩阵？

注意：虽然幻方只能包含 1 到 9 的数字，但 `grid` 可以包含最多15的数字。

 

**示例 1：**

![img](E:\NoteTakingSoftwares\Typora\Images\magic_main.jpg)

```
输入: grid = [[4,3,8,4],[9,5,1,9],[2,7,6,2]
输出: 1
解释: 
下面的子矩阵是一个 3 x 3 的幻方：

而这一个不是：

总的来说，在本示例所给定的矩阵中只有一个 3 x 3 的幻方子矩阵。
```

**示例 2:**

```
输入: grid = [[8]]
输出: 0
```

 

**提示:**

- `row == grid.length`
- `col == grid[i].length`
- `1 <= row, col <= 10`
- `0 <= grid[i][j] <= 15`



# 二、解题思路/解题过程



# 三、代码演示

## Java代码

```java
class Solution {
    public int numMagicSquaresInside(int[][] grid) {
        int m = grid.length;
        int n = grid[0].length;
        int ans = 0;

        // 遍历所有可能的 3x3 子矩阵左上角
        for (int i = 0; i < m - 2; i++) {
            for (int j = 0; j < n - 2; j++) {
                // 优化：幻方中心必须是 5
                if (grid[i + 1][j + 1] != 5) {
                    continue;
                }

                // 检查是否包含 1~9 且不重复
                boolean valid = true;
                boolean[] seen = new boolean[10]; // seen[0] ~ seen[9]，我们只关心 1~9

                int[] rowSum = new int[3];
                int[] colSum = new int[3];

                for (int r = 0; r < 3; r++) {
                    for (int c = 0; c < 3; c++) {
                        int num = grid[i + r][j + c];

                        // 如果数字不在 1~9 范围内，直接无效
                        if (num < 1 || num > 9) {
                            valid = false;
                            break;
                        }

                        // 如果这个数字已经出现过，也无效
                        if (seen[num]) {
                            valid = false;
                            break;
                        }
                        seen[num] = true;

                        rowSum[r] += num;
                        colSum[c] += num;
                    }
                    if (!valid) break; // 提前退出外层循环
                }

                // 如果数字检查失败，跳过
                if (!valid) {
                    continue;
                }

                // 检查前两行和前两列是否为 15（第三行/列自动满足）
                if (rowSum[0] == 15 && rowSum[1] == 15 &&
                    colSum[0] == 15 && colSum[1] == 15) {
                    ans++;
                }
            }
        }
        return ans;
    }
}
```



## Python代码



## C++代码



