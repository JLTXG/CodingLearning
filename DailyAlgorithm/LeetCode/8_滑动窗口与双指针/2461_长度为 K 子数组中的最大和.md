[2461. é•¿åº¦ä¸º K å­æ•°ç»„ä¸­çš„æœ€å¤§å’Œ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/maximum-sum-of-distinct-subarrays-with-length-k/description/)

>æ ‡ç­¾ï¼šæ•°ç»„  |  å“ˆå¸Œè¡¨  |  æ»‘åŠ¨çª—å£

# ä¸€ã€é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `k` ã€‚è¯·ä½ ä» `nums` ä¸­æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„å…¨éƒ¨å­æ•°ç»„ä¸­æ‰¾å‡ºæœ€å¤§å­æ•°ç»„å’Œï¼š

- å­æ•°ç»„çš„é•¿åº¦æ˜¯ `k`ï¼Œä¸”
- å­æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´  **å„ä¸ç›¸åŒ ã€‚**

è¿”å›æ»¡è¶³é¢˜é¢è¦æ±‚çš„æœ€å¤§å­æ•°ç»„å’Œã€‚å¦‚æœä¸å­˜åœ¨å­æ•°ç»„æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œè¿”å› `0` ã€‚

**å­æ•°ç»„** æ˜¯æ•°ç»„ä¸­ä¸€æ®µè¿ç»­éç©ºçš„å…ƒç´ åºåˆ—ã€‚

 

**ç¤ºä¾‹ 1ï¼š**

```
è¾“å…¥ï¼šnums = [1,5,4,2,9,9,9], k = 3
è¾“å‡ºï¼š15
è§£é‡Šï¼šnums ä¸­é•¿åº¦ä¸º 3 çš„å­æ•°ç»„æ˜¯ï¼š
- [1,5,4] æ»¡è¶³å…¨éƒ¨æ¡ä»¶ï¼Œå’Œä¸º 10 ã€‚
- [5,4,2] æ»¡è¶³å…¨éƒ¨æ¡ä»¶ï¼Œå’Œä¸º 11 ã€‚
- [4,2,9] æ»¡è¶³å…¨éƒ¨æ¡ä»¶ï¼Œå’Œä¸º 15 ã€‚
- [2,9,9] ä¸æ»¡è¶³å…¨éƒ¨æ¡ä»¶ï¼Œå› ä¸ºå…ƒç´  9 å‡ºç°é‡å¤ã€‚
- [9,9,9] ä¸æ»¡è¶³å…¨éƒ¨æ¡ä»¶ï¼Œå› ä¸ºå…ƒç´  9 å‡ºç°é‡å¤ã€‚
å› ä¸º 15 æ˜¯æ»¡è¶³å…¨éƒ¨æ¡ä»¶çš„æ‰€æœ‰å­æ•°ç»„ä¸­çš„æœ€å¤§å­æ•°ç»„å’Œï¼Œæ‰€ä»¥è¿”å› 15 ã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šnums = [4,4,4], k = 3
è¾“å‡ºï¼š0
è§£é‡Šï¼šnums ä¸­é•¿åº¦ä¸º 3 çš„å­æ•°ç»„æ˜¯ï¼š
- [4,4,4] ä¸æ»¡è¶³å…¨éƒ¨æ¡ä»¶ï¼Œå› ä¸ºå…ƒç´  4 å‡ºç°é‡å¤ã€‚
å› ä¸ºä¸å­˜åœ¨æ»¡è¶³å…¨éƒ¨æ¡ä»¶çš„å­æ•°ç»„ï¼Œæ‰€ä»¥è¿”å› 0 ã€‚
```

 

**æç¤ºï¼š**

- `1 <= k <= nums.length <= 10^5`
- `1 <= nums[i] <= 10^5`



# äºŒã€è§£é¢˜æ€è·¯\è§£é¢˜è¿‡ç¨‹

## è§£é¢˜æ€è·¯

è¿™æ˜¯ä»Šå¤©åšçš„ç¬¬ä¸€é“â€œæ»‘åŠ¨çª—å£â€ç±»çš„é¢˜ç›®ï¼Œå’Œæ˜¨å¤©çš„ç¬¬äºŒé“å¾ˆç›¸ä¼¼ï¼Œè¿™é“é¢˜è¦æ±‚çš„çª—å£å†…çš„æ•°æ®éƒ½ä¸ä¸€æ ·ï¼Œæ˜¨å¤©çš„ç¬¬äºŒé“â€œæ»‘åŠ¨çª—å£â€çš„é¢˜ç›®è¦æ±‚çª—å£å†…çš„æ•°æ®çš„ä¸åŒçš„ç§ç±»çš„æ•°å€¼å¤§äºç­‰äºæŸä¸ªé˜ˆå€¼ï¼Œæ‰€ä»¥ï¼Œè¿™é“é¢˜ç›®å°±æ˜¯æ¢ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶å³å¯ï¼Œå…¶ä»–çš„æ²¡ä»€ä¹ˆéœ€è¦æ”¹çš„ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```python
class Solution:
    def maximumSubarraySum(self, nums: List[int], k: int) -> int:
        windowSum, result, n = 0, 0, len(nums)
        freq = defaultdict(int)
        for i in range(n):
            # å…¥
            # å³ç«¯ç‚¹è¿›å…¥æ»‘åŠ¨çª—å£
            windowSum += nums[i]
            freq[nums[i]] += 1

            # æ›´æ–°ç­”æ¡ˆ
            left = i - k + 1
            if left < 0 :
                # æ­¤æ—¶å·¦ç«¯ç‚¹è¿˜æ²¡æœ‰è¿›å…¥æ»‘çª—
                continue
            if len(freq) == k :
                result = max(result, windowSum)

            # å‡º
            windowSum -= nums[left]
            freq[nums[left]] -= 1
            if freq[nums[left]] == 0 :
                freq.pop(nums[left])
        
        return result
```



## ğŸ“˜ Python `defaultdict` å®Œå…¨ç¬”è®°

> **æ‰€å±æ¨¡å—**ï¼š`collections`
> **ç”¨é€”**ï¼šè‡ªåŠ¨ä¸ºç¼ºå¤±çš„é”®ï¼ˆkeyï¼‰æä¾›é»˜è®¤å€¼çš„å­—å…¸ï¼ˆdict çš„å¢å¼ºç‰ˆï¼‰

------

### 1ã€ä¸ºä»€ä¹ˆéœ€è¦ `defaultdict`ï¼Ÿ

#### âŒ æ™®é€š `dict` çš„é—®é¢˜

å½“ä½ è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„ key æ—¶ï¼Œä¼šæŠ›å‡º `KeyError`ï¼š

```python
d = {}
print(d['missing'])  # KeyError: 'missing'
```

åœ¨**è®¡æ•°ã€åˆ†ç»„ã€ç´¯ç§¯**ç­‰åœºæ™¯ä¸­ï¼Œéœ€è¦é¢‘ç¹æ£€æŸ¥ key æ˜¯å¦å­˜åœ¨ï¼Œä»£ç å†—é•¿ï¼š

```python
# æ™®é€š dict å®ç°è®¡æ•°ï¼ˆå•°å—¦ï¼‰
freq = {}
for word in words:
    if word in freq:
        freq[word] += 1
    else:
        freq[word] = 1
```

#### âœ… `defaultdict` çš„ä¼˜åŠ¿

- **è‡ªåŠ¨åˆå§‹åŒ–ç¼ºå¤±çš„ key**
- **ä»£ç æ›´ç®€æ´ã€å¯è¯»æ€§æ›´é«˜**
- **é¿å… `KeyError`**

------

### 2ã€åŸºæœ¬è¯­æ³•ä¸åˆ›å»ºæ–¹å¼

#### ğŸ”§ å¯¼å…¥

```python
from collections import defaultdict
```

#### ğŸ“Œ åˆ›å»º

```python
dd = defaultdict(default_factory)
```

- `default_factory`ï¼šä¸€ä¸ª**å¯è°ƒç”¨å¯¹è±¡**ï¼ˆå‡½æ•°ï¼‰ï¼Œç”¨äºç”Ÿæˆé»˜è®¤å€¼
- å¸¸è§å·¥å‚å‡½æ•°ï¼š
    - `int` â†’ é»˜è®¤å€¼ `0`
    - `list` â†’ é»˜è®¤å€¼ `[]`
    - `set` â†’ é»˜è®¤å€¼ `set()`
    - `str` â†’ é»˜è®¤å€¼ `''`
    - è‡ªå®šä¹‰å‡½æ•°ï¼ˆè§åæ–‡ï¼‰

------

### 3ã€å¸¸ç”¨ `default_factory` ç¤ºä¾‹

| å·¥å‚å‡½æ•° | é»˜è®¤å€¼  | å…¸å‹ç”¨é€”             |
| -------- | ------- | -------------------- |
| `int`    | `0`     | è®¡æ•°ã€æ±‚å’Œ           |
| `list`   | `[]`    | åˆ†ç»„ã€æ”¶é›†åŒç±»é¡¹     |
| `set`    | `set()` | å»é‡åˆ†ç»„             |
| `str`    | `''`    | å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆè¾ƒå°‘ç”¨ï¼‰ |

#### âœ… ç¤ºä¾‹ 1ï¼šè®¡æ•°ï¼ˆæœ€å¸¸ç”¨ï¼‰

```python
from collections import defaultdict

words = ['apple', 'banana', 'apple']
freq = defaultdict(int)  # int() == 0
for w in words:
    freq[w] += 1

print(freq)  # defaultdict(<class 'int'>, {'apple': 2, 'banana': 1})
```

#### âœ… ç¤ºä¾‹ 2ï¼šåˆ†ç»„

```python
names = ['Alice', 'Bob', 'Anna']
by_first = defaultdict(list)  # list() == []
for name in names:
    by_first[name[0]].append(name)

print(dict(by_first))  # {'A': ['Alice', 'Anna'], 'B': ['Bob']}
```

#### âœ… ç¤ºä¾‹ 3ï¼šå»é‡åˆ†ç»„

```python
edges = 
graph = defaultdict(set)
for u, v in edges:
    graph[u].add(v)

print(dict(graph))  # {'A': {'B', 'C'}, 'B': {'A'}}
```

------

### 4ã€å·¥ä½œåŸç†ï¼ˆå†…éƒ¨æœºåˆ¶ï¼‰

å½“è®¿é—® `dd[key]` æ—¶ï¼š

1. å¦‚æœ `key` å­˜åœ¨ â†’ è¿”å›å¯¹åº”å€¼

2. å¦‚æœ 

    ```
    key
    ```

     ä¸å­˜åœ¨ï¼š

    - è°ƒç”¨ `default_factory()` ç”Ÿæˆé»˜è®¤å€¼
    - å°† `key: é»˜è®¤å€¼` æ’å…¥å­—å…¸
    - è¿”å›è¯¥é»˜è®¤å€¼

> ğŸ’¡ æ³¨æ„ï¼š**åªæœ‰é€šè¿‡ `dd[key]` è®¿é—®æ‰ä¼šè§¦å‘é»˜è®¤å€¼åˆ›å»º**
> ä½¿ç”¨ `dd.get(key)` ä¸ä¼šåˆ›å»ºæ–° keyï¼

```python
dd = defaultdict(int)
print(dd.get('x'))     # Noneï¼ˆä¸ä¼šåˆ›å»º 'x'ï¼‰
print(dd['x'])         # 0ï¼ˆä¼šåˆ›å»º 'x': 0ï¼‰
print('x' in dd)       # True
```

------

### 5ã€è‡ªå®šä¹‰ `default_factory`

ä½ å¯ä»¥ä¼ å…¥ä»»æ„å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€lambdaã€ç±»ç­‰ï¼‰ï¼š

#### âœ… ç¤ºä¾‹ï¼šé»˜è®¤å€¼ä¸º -1

```python
dd = defaultdict(lambda: -1)
print(dd['missing'])  # -1
```

#### âœ… ç¤ºä¾‹ï¼šé»˜è®¤å€¼ä¸ºå½“å‰æ—¶é—´

```python
from datetime import datetime
dd = defaultdict(datetime.now)
print(dd['first'])  # ç¬¬ä¸€æ¬¡è®¿é—®æ—¶çš„æ—¶é—´
print(dd['second']) # ç¬¬äºŒæ¬¡è®¿é—®æ—¶çš„æ—¶é—´ï¼ˆä¸åŒï¼ï¼‰
```

> âš ï¸ æ³¨æ„ï¼šå¦‚æœ `default_factory` æ˜¯æœ‰çŠ¶æ€çš„ï¼ˆå¦‚ `datetime.now`ï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨ç»“æœå¯èƒ½ä¸åŒã€‚

------

### 6ã€é‡è¦æ³¨æ„äº‹é¡¹ âš ï¸

#### 1. **`defaultdict` ä»ç„¶æ˜¯ `dict` çš„å­ç±»**

- æ”¯æŒæ‰€æœ‰ dict æ–¹æ³•ï¼š`.keys()`, `.values()`, `.items()`, `len()`, `in` ç­‰
- å¯ä»¥è½¬æ¢ä¸ºæ™®é€š dictï¼š`dict(dd)`

#### 2. **ä¸ä¼šè‡ªåŠ¨åˆ é™¤ key**

å³ä½¿å€¼å˜æˆâ€œç©ºâ€ï¼ˆå¦‚ `0`, `[]`ï¼‰ï¼Œkey ä¾ç„¶å­˜åœ¨ï¼

```python
dd = defaultdict(int)
dd['a'] = 0
print(len(dd))  # 1ï¼ˆ'a' ä»ç„¶å­˜åœ¨ï¼ï¼‰
```

âœ… **è§£å†³æ–¹æ¡ˆ**ï¼šæ‰‹åŠ¨æ¸…ç†

```python
if dd[key] == 0:
    del dd[key]   # æˆ– dd.pop(key)
```

> ğŸ“Œ è¿™æ­£æ˜¯ä½ åœ¨æ»‘åŠ¨çª—å£é¢˜ç›®ä¸­å¿…é¡»å†™ `freq.pop(nums[left])` çš„åŸå› ï¼

#### 3. **`default_factory` ä¸èƒ½æ˜¯ `None`**

```python
dd = defaultdict(None)  # åˆæ³•ï¼Œä½†è¡Œä¸º like æ™®é€š dict
dd['x']  # ä»ä¼šæŠ¥ KeyErrorï¼
```

#### 4. **æ€§èƒ½**

- æ¯”æ™®é€š dict ç•¥æ…¢ï¼ˆå› éœ€è°ƒç”¨å·¥å‚å‡½æ•°ï¼‰
- ä½†åœ¨éœ€è¦é¢‘ç¹åˆå§‹åŒ–çš„åœºæ™¯ä¸‹ï¼Œ**æ•´ä½“æ€§èƒ½æ›´å¥½**ï¼ˆå‡å°‘æ¡ä»¶åˆ¤æ–­ï¼‰

------

### 7ã€`defaultdict` vs æ™®é€š `dict` vs `dict.setdefault()`

| æ–¹æ³•                | ä»£ç ç¤ºä¾‹                          | ä¼˜ç¼ºç‚¹           |
| ------------------- | --------------------------------- | ---------------- |
| æ™®é€š `dict` + `if`  | `if k in d: d[k]+=1 else: d[k]=1` | å†—é•¿             |
| `dict.setdefault()` | `d.setdefault(k, 0); d[k] += 1`   | ä¸­ç­‰ç®€æ´         |
| **`defaultdict`**   | `d[k] += 1`                       | **æœ€ç®€æ´ï¼Œæ¨è** |

> âœ… `setdefault` ç¤ºä¾‹ï¼š
>
> ```python
> d = {}
> d.setdefault('a', []).append(1)
> ```

------

### 8ã€å…¸å‹åº”ç”¨åœºæ™¯ï¼ˆLeetCode / å®æˆ˜ï¼‰

| åœºæ™¯               | æ¨èç”¨æ³•                                     |
| ------------------ | -------------------------------------------- |
| **æ»‘åŠ¨çª—å£è®¡æ•°**   | `defaultdict(int)` + æ‰‹åŠ¨ `pop` æ¸…ç†         |
| **å›¾çš„é‚»æ¥è¡¨**     | `defaultdict(list)` æˆ– `defaultdict(set)`    |
| **å•è¯é¢‘æ¬¡ç»Ÿè®¡**   | `defaultdict(int)`                           |
| **æŒ‰ç±»åˆ«åˆ†ç»„æ•°æ®** | `defaultdict(list)`                          |
| **å‰ç¼€å’Œç´¢å¼•**     | `defaultdict(list)` å­˜å‚¨å¤šä¸ªç›¸åŒå‰ç¼€å’Œçš„ä½ç½® |

------



# ä¸‰ã€ä»£ç æ¼”ç¤º

## Javaä»£ç 

```Java
class Solution {
    public long maximumSubarraySum(int[] nums, int k) { 
        int n = nums.length;
        long windowSum = 0, result = 0;
        Map<Integer, Integer> freq = new HashMap<>();
        for (int i = 0; i < n; i++) {
            // å…¥
            // å³ç«¯ç‚¹è¿›æ»‘çª—
            windowSum += nums[i];
            freq.put(nums[i], freq.getOrDefault(nums[i], 0) + 1);

            // æ›´æ–°ç­”æ¡ˆ
            int left = i - k + 1;
            if (left < 0) {
                // æ­¤æ—¶å·¦ç«¯ç‚¹è¿˜æ²¡æœ‰è¿›å…¥æ»‘çª—
                continue;
            }
            if (freq.size() == k) {
                result = Math.max(result, windowSum);
            }

            // å‡º
            windowSum -= nums[left];
            freq.put(nums[left], freq.get(nums[left]) - 1);
            if (freq.get(nums[left]) == 0) {
                // åªæœ‰è®¡æ•°ä¸º 0 æ‰ç§»é™¤
                freq.remove(nums[left]);
            }
        }
        return result;
    }
}
```



## Pythonä»£ç 

```Python
class Solution:
    def maximumSubarraySum(self, nums: List[int], k: int) -> int:
        windowSum, result, n = 0, 0, len(nums)
        freq = defaultdict(int)
        for i in range(n):
            # å…¥
            # å³ç«¯ç‚¹è¿›å…¥æ»‘åŠ¨çª—å£
            windowSum += nums[i]
            freq[nums[i]] += 1

            # æ›´æ–°ç­”æ¡ˆ
            left = i - k + 1
            if left < 0 :
                # æ­¤æ—¶å·¦ç«¯ç‚¹è¿˜æ²¡æœ‰è¿›å…¥æ»‘çª—
                continue
            if len(freq) == k :
                result = max(result, windowSum)

            # å‡º
            windowSum -= nums[left]
            freq[nums[left]] -= 1
            if freq[nums[left]] == 0 :
                freq.pop(nums[left])
        
        return result
```

![2461_é•¿åº¦ä¸º K å­æ•°ç»„ä¸­çš„æœ€å¤§å’Œ_Python](https://gitee.com/lei-weijun/CodingLearning/raw/main/DailyAlgorithm/LeetCode/8_%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E4%B8%8E%E5%8F%8C%E6%8C%87%E9%92%88/Images/2461_%E9%95%BF%E5%BA%A6%E4%B8%BA%20K%20%E5%AD%90%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E5%92%8C_Python.png)

## C++ä»£ç 

```C++
class Solution {
public:
    long long maximumSubarraySum(vector<int>& nums, int k) {
        long long windowSum = 0, result = 0;
        int n = nums.size();
        unordered_map<int, int> freq;
        for (int i = 0; i < n; i++) {
            // å…¥
            // å³ç«¯ç‚¹è¿›å…¥æ»‘çª—
            windowSum += nums[i];
            freq[nums[i]]++;

            // æ›´æ–°ç­”æ¡ˆ
            int left = i - k + 1;
            if (left < 0) {
                // æ­¤æ—¶å·¦ç«¯ç‚¹è¿˜æ²¡æœ‰è¿›å…¥æ»‘çª—
                continue;
            }
            if (freq.size() == k) {
                result = max(result, windowSum);
            }

            // å‡º
            windowSum -= nums[left];
            freq[nums[left]]--;
            if (freq[nums[left]] == 0) {
                // åªæœ‰è®¡æ•°ä¸º 0 æ‰ç§»é™¤
                freq.erase(nums[left]);
            }
        }
        return result;
    }
};
```

