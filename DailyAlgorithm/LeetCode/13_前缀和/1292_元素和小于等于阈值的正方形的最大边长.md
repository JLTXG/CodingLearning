[1292. å…ƒç´ å’Œå°äºç­‰äºé˜ˆå€¼çš„æ­£æ–¹å½¢çš„æœ€å¤§è¾¹é•¿ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/maximum-side-length-of-a-square-with-sum-less-than-or-equal-to-threshold/description/?envType=daily-question&envId=2026-01-19)

>æ ‡ç­¾ï¼šæ•°ç»„  |  äºŒåˆ†æŸ¥æ‰¾  |  çŸ©é˜µ  |  å‰ç¼€å’Œ

# ä¸€ã€é¢˜ç›®æè¿°

ç»™ä½ ä¸€ä¸ªå¤§å°ä¸º `m x n` çš„çŸ©é˜µ `mat` å’Œä¸€ä¸ªæ•´æ•°é˜ˆå€¼ `threshold`ã€‚

è¯·ä½ è¿”å›å…ƒç´ æ€»å’Œå°äºæˆ–ç­‰äºé˜ˆå€¼çš„æ­£æ–¹å½¢åŒºåŸŸçš„æœ€å¤§è¾¹é•¿ï¼›å¦‚æœæ²¡æœ‰è¿™æ ·çš„æ­£æ–¹å½¢åŒºåŸŸï¼Œåˆ™è¿”å› **0** ã€‚
 

**ç¤ºä¾‹ 1ï¼š**

![img](E:\NoteTakingSoftwares\Typora\Images\e1.png)

```
è¾“å…¥ï¼šmat = [[1,1,3,2,4,3,2],[1,1,3,2,4,3,2],[1,1,3,2,4,3,2]], threshold = 4
è¾“å‡ºï¼š2
è§£é‡Šï¼šæ€»å’Œå°äºæˆ–ç­‰äº 4 çš„æ­£æ–¹å½¢çš„æœ€å¤§è¾¹é•¿ä¸º 2ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚
```

**ç¤ºä¾‹ 2ï¼š**

```
è¾“å…¥ï¼šmat = [[2,2,2,2,2],[2,2,2,2,2],[2,2,2,2,2],[2,2,2,2,2],[2,2,2,2,2]], threshold = 1
è¾“å‡ºï¼š0
```

 

**æç¤ºï¼š**

- `m == mat.length`
- `n == mat[i].length`
- `1 <= m, n <= 300`
- `0 <= mat[i][j] <= 10^4`
- `0 <= threshold <= 10^5` 



# äºŒã€è§£é¢˜æ€è·¯\è§£é¢˜è¿‡ç¨‹

## ğŸ§  1ã€è§£é¢˜æ€è·¯æ€»è§ˆ

| æ­¥éª¤ | ç›®æ ‡                                                         |
| ---- | ------------------------------------------------------------ |
| 1ï¸âƒ£    | å¿«é€Ÿè®¡ç®—ä»»æ„å­çŸ©é˜µçš„å’Œ â†’ **äºŒç»´å‰ç¼€å’Œ**                      |
| 2ï¸âƒ£    | æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„æœ€å¤§ `k` â†’ **äºŒåˆ†æŸ¥æ‰¾**ï¼ˆæˆ–ä»å¤§åˆ°å°æšä¸¾ï¼‰      |
| 3ï¸âƒ£    | å¯¹æ¯ä¸ªå€™é€‰ `k`ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨åˆæ³•æ­£æ–¹å½¢ â†’ **æš´åŠ›æšä¸¾æ‰€æœ‰ä½ç½®** |

> âœ… æ ¸å¿ƒæ€æƒ³ï¼š**â€œå¿«é€ŸæŸ¥è¯¢ + æ™ºèƒ½æœç´¢â€**

---

## ğŸ“ 2ã€å…³é”®å·¥å…·ï¼šäºŒç»´å‰ç¼€å’Œï¼ˆ2D Prefix Sumï¼‰

### 2.1 ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ

- å¦‚æœæ¯æ¬¡è®¡ç®— `kÃ—k` æ­£æ–¹å½¢éƒ½éå† `kÂ²` ä¸ªå…ƒç´ ï¼Œæ€»å¤æ‚åº¦ä¼šçˆ†ç‚¸ã€‚
- **äºŒç»´å‰ç¼€å’Œ**å¯ä»¥åœ¨ **O(1)** æ—¶é—´å†…è®¡ç®—ä»»æ„çŸ©å½¢åŒºåŸŸçš„å’Œï¼

### 2.2 å®šä¹‰

è®¾ `pref[i][j]` è¡¨ç¤ºä» `(0, 0)` åˆ° `(i-1, j-1)`ï¼ˆ**å·¦ä¸Šè§’åŒ…å«ï¼Œå³ä¸‹è§’ä¸åŒ…å«**ï¼‰çš„çŸ©å½¢å…ƒç´ å’Œã€‚

> ğŸ’¡ ä½¿ç”¨ `m+1` è¡Œã€`n+1` åˆ—çš„ `pref` æ•°ç»„ï¼Œé¿å…è¾¹ç•Œåˆ¤æ–­ã€‚

### 2.3 æ„å»ºå…¬å¼

```text
pref[i+1][j+1] = mat[i][j] 
                + pref[i][j+1]   // ä¸Šæ–¹çŸ©å½¢
                + pref[i+1][j]   // å·¦ä¾§çŸ©å½¢
                - pref[i][j]     // é‡å éƒ¨åˆ†å‡ä¸€æ¬¡
```

### 2.4 æŸ¥è¯¢ä»»æ„çŸ©å½¢å’Œï¼ˆé—­åŒºé—´ [r1, r2] Ã— [c1, c2]ï¼‰

```text
sum = pref[r2+1][c2+1] 
    - pref[r1][c2+1] 
    - pref[r2+1][c1] 
    + pref[r1][c1]
```

> âœ… è®°å¿†å£è¯€ï¼š**â€œå¤§çŸ©å½¢ - ä¸Š - å·¦ + é‡å â€**

---

## ğŸ” 3ã€å¦‚ä½•æ‰¾æœ€å¤§ `k`ï¼Ÿâ€”â€” ä¸¤ç§ç­–ç•¥

### âœ… æ¨èç­–ç•¥ï¼š**äºŒåˆ†æŸ¥æ‰¾ + å¯è¡Œæ€§æ£€æŸ¥**

- `k` çš„å–å€¼èŒƒå›´ï¼š`0 â‰¤ k â‰¤ min(m, n)`
- å‡½æ•° `check(k)`ï¼šæ˜¯å¦å­˜åœ¨ä¸€ä¸ª `kÃ—k` æ­£æ–¹å½¢ï¼Œå…¶å’Œ â‰¤ thresholdï¼Ÿ
- å› ä¸º `k` è¶Šå¤§è¶Šéš¾æ»¡è¶³æ¡ä»¶ï¼Œå…·æœ‰**å•è°ƒæ€§** â†’ å¯äºŒåˆ†ï¼

### äºŒåˆ†æ¨¡æ¿ï¼ˆæ‰¾æœ€å¤§å¯è¡Œå€¼ï¼‰ï¼š

```java
int left = 0, right = maxK;
while (left < right) {
    int mid = (left + right + 1) / 2; // ä¸Šå–æ•´
    if (check(mid)) {
        left = mid;   // å¯è¡Œï¼Œå°è¯•æ›´å¤§çš„
    } else {
        right = mid - 1; // ä¸å¯è¡Œï¼Œç¼©å°
    }
}
return left;
```

> âš ï¸ æ³¨æ„ï¼š`(left + right + 1) / 2` æ˜¯ä¸ºäº†é¿å…æ­»å¾ªç¯ï¼ˆå½“ `left = mid` æ—¶ï¼‰

---

## ğŸ’» 4ã€å®Œæ•´ä»£ç è¯¦è§£ï¼ˆJavaï¼‰

```java
class Solution {
    public int maxSideLength(int[][] mat, int threshold) {
        int m = mat.length, n = mat[0].length;
        
        // Step 1: æ„å»ºäºŒç»´å‰ç¼€å’Œæ•°ç»„ pref[m+1][n+1]
        int[][] pref = new int[m + 1][n + 1];
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                pref[i + 1][j + 1] = mat[i][j] 
                                    + pref[i][j + 1]   // ä¸Š
                                    + pref[i + 1][j]   // å·¦
                                    - pref[i][j];      // é‡å 
            }
        }

        // Step 2: äºŒåˆ†æŸ¥æ‰¾æœ€å¤§è¾¹é•¿ k
        int left = 0, right = Math.min(m, n);
        while (left < right) {
            int mid = (left + right + 1) / 2;
            if (check(pref, mid, threshold, m, n)) {
                left = mid;        // å¯è¡Œï¼Œä¿ç•™ mid å¹¶å°è¯•æ›´å¤§
            } else {
                right = mid - 1;   // ä¸å¯è¡Œï¼Œæ”¾å¼ƒ mid åŠä»¥ä¸Š
            }
        }
        return left;
    }

    // è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¾¹é•¿ä¸º k çš„æ­£æ–¹å½¢æ»¡è¶³ sum <= threshold
    private boolean check(int[][] pref, int k, int threshold, int m, int n) {
        if (k == 0) return true; // è¾¹é•¿ä¸º0æ€»æ˜¯åˆæ³•
        
        // æšä¸¾æ‰€æœ‰å¯èƒ½çš„å·¦ä¸Šè§’ (i, j)
        for (int i = 0; i <= m - k; i++) {      // è¡Œï¼š0 åˆ° m-k
            for (int j = 0; j <= n - k; j++) {  // åˆ—ï¼š0 åˆ° n-k
                // è®¡ç®— [i, i+k-1] Ã— [j, j+k-1] çš„å’Œ
                int r1 = i, c1 = j;
                int r2 = i + k - 1, c2 = j + k - 1;
                int sum = pref[r2 + 1][c2 + 1] 
                        - pref[r1][c2 + 1] 
                        - pref[r2 + 1][c1] 
                        + pref[r1][c1];
                
                if (sum <= threshold) {
                    return true; // æ‰¾åˆ°ä¸€ä¸ªå°±è¿”å›
                }
            }
        }
        return false; // å…¨éƒ¨éƒ½ä¸æ»¡è¶³
    }
}
```

---

## ğŸ“Š 5ã€å¤æ‚åº¦åˆ†æ

| é¡¹ç›®           | å¤æ‚åº¦                                                       |
| -------------- | ------------------------------------------------------------ |
| **æ—¶é—´å¤æ‚åº¦** | `O(mn log(min(m, n)))`  <br>â€¢ æ„å»ºå‰ç¼€å’Œï¼š`O(mn)`  <br>â€¢ äºŒåˆ†æœ€å¤š `log(min(m,n))` æ¬¡  <br>â€¢ æ¯æ¬¡ checkï¼š`O((mâˆ’k)(nâˆ’k)) â‰ˆ O(mn)` |
| **ç©ºé—´å¤æ‚åº¦** | `O(mn)`ï¼ˆå­˜å‚¨ `pref` æ•°ç»„ï¼‰                                  |

> âœ… åœ¨ `m, n â‰¤ 300` æ—¶ï¼Œæ€»æ“ä½œæ•°çº¦ `300Ã—300Ã—9 â‰ˆ 810,000`ï¼Œéå¸¸é«˜æ•ˆã€‚

---

## ğŸ§ª 6ã€ä¸¾ä¸ªä¾‹å­ï¼ˆæ‰‹åŠ¨éªŒè¯ï¼‰

```text
mat = [
  [1, 1, 3, 2],
  [3, 2, 1, 1],
  [2, 2, 1, 2]
]
threshold = 4
```

- `k=2` æ—¶ï¼Œå­çŸ©é˜µ `[ [1,1], [3,2] ]` å’Œä¸º `1+1+3+2=7 > 4` âŒ
- ä½†å­çŸ©é˜µ `[ [1,3], [2,1] ]`ï¼ˆå³ä¸Šè§’ï¼‰å’Œä¸º `1+3+2+1=7` âŒ
- å­çŸ©é˜µ `[ [1,1], [2,1] ]`ï¼ˆå·¦ä¸‹è§’ï¼‰å’Œä¸º `1+1+2+1=5` âŒ
- ä½† `k=1` æ—¶ï¼Œå¾ˆå¤šå•ä¸ªå…ƒç´  â‰¤4ï¼ˆå¦‚ `1,2,3`ï¼‰âœ…
- å®é™…ç­”æ¡ˆæ˜¯ `k=2`ï¼Ÿç­‰ç­‰â€¦â€¦å†çœ‹ï¼š

> å…¶å®å³ä¸‹è§’ `[ [1,1], [1,2] ]` â†’ å’Œ = 1+1+1+2 = **5** âŒ  
> ä½†ä¸­é—´ `[ [2,1], [2,1] ]` â†’ 2+1+2+1 = **6** âŒ  
> å“¦ï¼å·¦ä¸Šè§’ `[ [1,1], [3,2] ]` = 7ï¼Œä¸è¡Œâ€¦â€¦

ç­‰ç­‰ï¼Œæœ‰æ²¡æœ‰ `k=2` åˆæ³•ï¼Ÿ  
çœ‹ `[ [3,2], [2,2] ]`ï¼ˆç¬¬1-2è¡Œï¼Œç¬¬0-1åˆ—ï¼‰â†’ 3+2+2+2=9 âŒ  
å…¶å® **æœ€å¤§åˆæ³• `k=1`**ï¼Ÿä½†é¢˜ç›®ç¤ºä¾‹è¯´ç­”æ¡ˆæ˜¯ `2`ã€‚

> âœ… æ­£ç¡®ä¾‹å­ï¼š`mat = [[1,1,1],[1,0,0],[1,0,0]]`, `threshold=4` â†’ `k=2`ï¼ˆå·¦ä¸Šè§’ 2x2 å’Œ=3ï¼‰

æ‰€ä»¥ç®—æ³•ä¼šæ­£ç¡®æ‰¾åˆ°ï¼

---

## ğŸ“ 7ã€ç¬”è®°è¦ç‚¹æ€»ç»“

1. **äºŒç»´å‰ç¼€å’Œ**æ˜¯è§£å†³â€œå­çŸ©é˜µå’Œâ€é—®é¢˜çš„æ ‡å‡†å·¥å…·ã€‚
2. `pref[i+1][j+1] = mat[i][j] + pref[i][j+1] + pref[i+1][j] - pref[i][j]`
3. æŸ¥è¯¢çŸ©å½¢å’Œï¼š`sum = pref[r2+1][c2+1] - pref[r1][c2+1] - pref[r2+1][c1] + pref[r1][c1]`
4. æœ€å¤§åŒ– `k` ä¸”å…·æœ‰å•è°ƒæ€§ â†’ **äºŒåˆ†æŸ¥æ‰¾**
5. äºŒåˆ†æ¨¡æ¿ï¼ˆæœ€å¤§å¯è¡Œå€¼ï¼‰ï¼š`mid = (left + right + 1) / 2`
6. æšä¸¾æ­£æ–¹å½¢å·¦ä¸Šè§’ï¼š`i âˆˆ [0, mâˆ’k]`, `j âˆˆ [0, nâˆ’k]`
7. æ—¶é—´å¤æ‚åº¦ï¼š`O(mn log(min(m,n)))`ï¼Œç©ºé—´ï¼š`O(mn)`

---



# ä¸‰ã€ä»£ç æ¼”ç¤º

## Javaä»£ç 

```Java
class Solution {
    public int maxSideLength(int[][] mat, int threshold) {
        int m = mat.length, n = mat[0].length;

        // Step 1ï¼šæ„å»ºäºŒç»´å‰ç¼€å’Œæ•°ç»„ pref[m + 1][n + 1]
        int[][] pref = new int[m + 1][n + 1];
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                pref[i + 1][j + 1] = mat[i][j]
                                     + pref[i][j + 1]  // ä¸Š
                                     + pref[i + 1][j]  // å·¦
                                     - pref[i][j];     // é‡å 
            }
        }

        // Step 2ï¼šäºŒåˆ†æŸ¥æ‰¾æœ€å¤§è¾¹é•¿ k
        int left = 0, rigth = Math.min(m, n);
        while (left < rigth) {
            int mid = (left + rigth + 1) / 2;
            if (check(pref, mid, threshold, m, n)) {
                left = mid;  // å¯è¡Œï¼Œä¿ç•™ mid å¹¶å°è¯•æ›´å¤§
            } else {
                rigth = mid - 1;  // ä¸å¯è¡Œï¼Œæ”¾å¼ƒ mid åŠä»¥ä¸Š
            }
        }
        return left;
    }

    // è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¾¹é•¿ä¸º k çš„æ­£æ–¹å½¢æ»¡è¶³ sum <= threshold
    private boolean check(int[][] pref, int k, int threshold, int m, int n) {
        if (k == 0) return true;  // è¾¹é•¿ä¸º0æ€»æ˜¯åˆæ³•

        // æšä¸¾æ‰€æœ‰å¯èƒ½çš„å·¦ä¸Šè§’ï¼ˆi, jï¼‰
        for (int i = 0; i <= m - k; i++) {  // è¡Œï¼š0 åˆ° m - k
            for (int j = 0; j <= n - k; j++) {  // åˆ—ï¼š0 åˆ° n - k
                // è®¡ç®— [i, i + k - 1] x [j, j + k - 1] çš„å’Œ
                int r1 = i, c1 = j;
                int r2 = i + k -1, c2 = j + k - 1;
                int sum = pref[r2 + 1][c2 + 1]
                        - pref[r1][c2 + 1]
                        - pref[r2 + 1][c1]
                        + pref[r1][c1];

                if (sum <= threshold) {
                    return true;  // æ‰¾åˆ°ä¸€ä¸ªå°±è¿”å›
                }
            }
        }
        return false;  // å…¨éƒ¨éƒ½ä¸æ»¡è¶³
    }
}
```

![1292_å…ƒç´ å’Œå°äºç­‰äºé˜ˆå€¼çš„æ­£æ–¹å½¢çš„æœ€å¤§è¾¹é•¿_Java]()

## Pythonä»£ç 

```Python
class Solution:
    def maxSideLength(self, mat: List[List[int]], threshold: int) -> int:
        m, n = len(mat), len(mat[0])

        # Step 1ï¼šæ„å»ºäºŒç»´å‰ç¼€å’Œæ•°ç»„ pref[m + 1][n + 1]
        pref = [[0] * (n + 1) for _ in range(m + 1)]
        for i in range(m):
            for j in range(n):
                pref[i + 1][j + 1] = mat[i][j] + pref[i][j + 1] + pref[i + 1][j] - pref[i][j]
        
        # Step 2ï¼šäºŒåˆ†æŸ¥æ‰¾æœ€å¤§è¾¹é•¿ k
        left, right = 0, min(m, n)
        while left < right :
            mid = (left + right + 1) // 2
            if self.check(pref, mid, threshold, m, n) :
                left = mid  # å¯è¡Œï¼Œä¿ç•™ mid å¹¶å°è¯•æ›´å¤§
            else:
                right = mid - 1  # ä¸å¯è¡Œï¼Œæ”¾å¼ƒ mid åŠä»¥ä¸Š
        return left
    
    def check(self, pref: List[List[int]], k: int, threshold: int, m: int, n: int) -> bool:
        if k == 0 :
            # è¾¹é•¿ä¸º 0 æ€»æ˜¯åˆæ³•
            return True
        
        # æšä¸¾æ‰€æœ‰å¯èƒ½çš„å·¦ä¸Šè§’ (i, j)
        for i in range(m - k + 1):  # è¡Œï¼š0 åˆ° m - k
            for j in range(n - k + 1):  # åˆ—ï¼š0 åˆ° n - k
                # è®¡ç®— [i, i + k - 1] x [j, j + k - 1] çš„å’Œ
                r1, c1 = i, j
                r2, c2 = i + k - 1, j + k - 1
                max_sum = pref[r2 + 1][c2 + 1] - pref[r1][c2 + 1] - pref[r2 + 1][c1] + pref[r1][c1]
                    
                if max_sum <= threshold :
                    # æ‰¾åˆ°ä¸€ä¸ªå°±è¿”å›
                    return True
        
        # å…¨éƒ¨éƒ½ä¸æ»¡è¶³
        return False
```



## C++ä»£ç 

```C++
class Solution {
public:
    int maxSideLength(vector<vector<int>>& mat, int threshold) {
        int m = mat.size(), n = mat[0].size();

        // Step 1ï¼šæ„å»ºäºŒç»´å‰ç¼€å’Œæ•°ç»„ pref[m + 1][n + 1]
        vector<vector<int>> pref(m + 1, vector<int>(n + 1));
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                pref[i + 1][j + 1] = mat[i][j]
                                    + pref[i][j + 1]  // ä¸Š
                                    + pref[i + 1][j]  // å·¦
                                    - pref[i][j];     // é‡å 
            }
        }

        // Step 2ï¼šäºŒåˆ†æŸ¥æ‰¾æœ€å¤§è¾¹é•¿ k
        int left = 0, rigth = min(m, n);
        while (left < rigth) {
            int mid = (left + rigth + 1) / 2;
            if (check(pref, mid, threshold, m, n)) {
                left = mid;  // å¯è¡Œï¼Œä¿ç•™ mid å¹¶å°è¯•æ›´å¤§
            } else {
                rigth = mid - 1;  // ä¸å¯è¡Œï¼Œæ”¾å¼ƒ mid åŠä»¥ä¸Š
            }
        }
        return left;
    }

private:
    // è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¾¹é•¿ä¸º k çš„æ­£æ–¹å½¢æ»¡è¶³ sum <= threshold
    bool check(vector<vector<int>> pref, int k, int threshold, int m, int n) {
        if (k == 0) return true;  // è¾¹é•¿ä¸º 0 æ€»æ˜¯åˆæ³•

        // æšä¸¾æ‰€æœ‰å¯èƒ½çš„å·¦ä¸Šè§’ (i, j)
        for (int i = 0; i <= m - k; i++) {  // è¡Œï¼š0 åˆ° m - k
            for (int j = 0; j <= n - k; j++) {  // åˆ—ï¼š0 åˆ° n - k
                // è®¡ç®— [i, i + k - 1] x [j, j + k - 1] çš„å’Œ
                int r1 = i, c1 = j;
                int r2 = i + k - 1, c2 = j + k - 1;
                int sum = pref[r2 + 1][c2 + 1]
                        - pref[r1][c2 + 1]
                        - pref[r2 + 1][c1]
                        + pref[r1][c1];

                if (sum <= threshold) {
                    return true;  // æ‰¾åˆ°ä¸€ä¸ªå°±è¿”å›
                }
            }
        }
        return false;  // å…¨éƒ¨éƒ½ä¸æ»¡è¶³
    }
};
```

