[1895. æœ€å¤§çš„å¹»æ–¹ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/largest-magic-square/description/?envType=daily-question&envId=2026-01-18)

>æ ‡ç­¾ï¼šæ•°ç»„  |  çŸ©é˜µ  |  å‰ç¼€å’Œ

# ä¸€ã€é¢˜ç›®æè¿°

ä¸€ä¸ª `k x k` çš„ **å¹»æ–¹** æŒ‡çš„æ˜¯ä¸€ä¸ª `k x k` å¡«æ»¡æ•´æ•°çš„æ–¹æ ¼é˜µï¼Œä¸”æ¯ä¸€è¡Œã€æ¯ä¸€åˆ—ä»¥åŠä¸¤æ¡å¯¹è§’çº¿çš„å’Œ **å…¨éƒ¨****ç›¸ç­‰** ã€‚å¹»æ–¹ä¸­çš„æ•´æ•° **ä¸éœ€è¦äº’ä¸ç›¸åŒ** ã€‚æ˜¾ç„¶ï¼Œæ¯ä¸ª `1 x 1` çš„æ–¹æ ¼éƒ½æ˜¯ä¸€ä¸ªå¹»æ–¹ã€‚

ç»™ä½ ä¸€ä¸ª `m x n` çš„æ•´æ•°çŸ©é˜µ `grid` ï¼Œè¯·ä½ è¿”å›çŸ©é˜µä¸­ **æœ€å¤§å¹»æ–¹** çš„ **å°ºå¯¸** ï¼ˆå³è¾¹é•¿ `k`ï¼‰ã€‚

 

**ç¤ºä¾‹ 1ï¼š**

![img](E:\NoteTakingSoftwares\Typora\Images\magicsquare-grid.jpg)

```
è¾“å…¥ï¼šgrid = [[7,1,4,5,6],[2,5,1,6,4],[1,5,4,3,2],[1,2,7,3,4]]
è¾“å‡ºï¼š3
è§£é‡Šï¼šæœ€å¤§å¹»æ–¹å°ºå¯¸ä¸º 3 ã€‚
æ¯ä¸€è¡Œï¼Œæ¯ä¸€åˆ—ä»¥åŠä¸¤æ¡å¯¹è§’çº¿çš„å’Œéƒ½ç­‰äº 12 ã€‚
- æ¯ä¸€è¡Œçš„å’Œï¼š5+1+6 = 5+4+3 = 2+7+3 = 12
- æ¯ä¸€åˆ—çš„å’Œï¼š5+5+2 = 1+4+7 = 6+3+3 = 12
- å¯¹è§’çº¿çš„å’Œï¼š5+4+3 = 6+4+2 = 12
```

**ç¤ºä¾‹ 2ï¼š**

![img](E:\NoteTakingSoftwares\Typora\Images\magicsquare2-grid.jpg)

```
è¾“å…¥ï¼šgrid = [[5,1,3,1],[9,3,3,1],[1,3,3,8]]
è¾“å‡ºï¼š2
```

 

**æç¤ºï¼š**

- `m == grid.length`
- `n == grid[i].length`
- `1 <= m, n <= 50`
- `1 <= grid[i][j] <= 10^6`



# äºŒã€è§£é¢˜æ€è·¯\è§£é¢˜è¿‡ç¨‹

æ—¥å¸¸æ²¡æœ‰æ€è·¯ï¼Œä»¥ä¸‹æ€è·¯å‚è€ƒçµç¥çš„é¢˜è§£â€”â€”[1895. æœ€å¤§çš„å¹»æ–¹ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰](https://leetcode.cn/problems/largest-magic-square/solutions/825422/go-qian-zhui-he-by-endlesscheng-59wj/?envType=daily-question&envId=2026-01-18)â€”â€”å…·ä½“å¦‚ä¸‹ï¼š

## âœ… æ ¸å¿ƒæ€æƒ³

- **æš´åŠ›æšä¸¾æ‰€æœ‰å¯èƒ½çš„æ­£æ–¹å½¢å­çŸ©é˜µ**ï¼ˆä»å¤§åˆ°å°å°è¯•ï¼Œä¸€æ—¦æ‰¾åˆ°å°±è¿”å›ï¼Œä¿è¯æœ€å¤§ï¼‰
- ä½¿ç”¨ **å‰ç¼€å’Œä¼˜åŒ–** å¿«é€Ÿè®¡ç®—ä»»æ„è¡Œã€åˆ—ã€å¯¹è§’çº¿çš„å’Œ
- åˆ¤æ–­æ˜¯å¦æ»¡è¶³é­”æ³•æ–¹é˜µæ¡ä»¶

---

## ğŸ“Œ å‰ç¼€å’Œæ•°ç»„è¯´æ˜

1. **`row_sum[i][j]`**  
    è¡¨ç¤ºç¬¬ `i` è¡Œå‰ `j` ä¸ªå…ƒç´ çš„å’Œï¼ˆ`j` ä» 0 å¼€å§‹ï¼Œæ‰€ä»¥é•¿åº¦ä¸º `n+1`ï¼‰  
    â†’ ç”¨äºå¿«é€Ÿè®¡ç®—æŸè¡Œ `[l, r)` åŒºé—´çš„å’Œï¼š`row_sum[i][r] - row_sum[i][l]`
2. **`col_sum[i][j]`**  
    è¡¨ç¤ºç¬¬ `j` åˆ—å‰ `i` ä¸ªå…ƒç´ çš„å’Œï¼ˆ`i` ä» 0 å¼€å§‹ï¼Œæ‰€ä»¥é•¿åº¦ä¸º `m+1`ï¼‰  
    â†’ è®¡ç®—æŸåˆ— `[top, bottom)` çš„å’Œï¼š`col_sum[bottom][j] - col_sum[top][j]`
3. **`diag_sum[i][j]`**  
    è¡¨ç¤ºä» `(0,0)` åˆ° `(i-1, j-1)` çš„ä¸»å¯¹è§’çº¿æ–¹å‘ï¼ˆâ†˜ï¼‰çš„â€œç´¯ç§¯å’Œâ€  
    â†’ ä¸»å¯¹è§’çº¿å’Œ = `diag_sum[i][j] - diag_sum[i-k][j-k]`
4. **`anti_sum[i][j]`**  
    è¡¨ç¤ºä»å³ä¸Šå¾€å·¦ä¸‹çš„åå¯¹è§’çº¿ï¼ˆâ†™ï¼‰æ–¹å‘çš„å‰ç¼€å’Œ
    
    > æ³¨æ„ï¼š`anti_sum[i+1][j] = anti_sum[i][j+1] + grid[i][j]`  
    > â†’ åå¯¹è§’çº¿å’Œ = `anti_sum[i][j - k] - anti_sum[i - k][j]`
    

> ğŸ’¡ æŠ€å·§ï¼š`anti_sum` çš„é€’æ¨æ˜¯â€œå‘å·¦ä¸‹èµ°â€ï¼Œæ‰€ä»¥å½“å‰ `(i,j)` çš„å€¼æ¥è‡ª `(i-1, j+1)`

---

## ğŸ”„ æšä¸¾é€»è¾‘

- ä»æœ€å¤§å¯èƒ½çš„ `k = min(m, n)` å¼€å§‹å¾€ä¸‹è¯•ï¼ˆè´ªå¿ƒï¼Œç¬¬ä¸€ä¸ªæ»¡è¶³çš„å°±æ˜¯ç­”æ¡ˆï¼‰
- å¯¹æ¯ä¸ª `k`ï¼Œéå†æ‰€æœ‰å¯èƒ½çš„ `k x k` å­çŸ©é˜µï¼š
    - å·¦ä¸Šè§’ä¸º `(i - k, j - k)`
    - å³ä¸‹è§’ä¸º `(i - 1, j - 1)`
    - å…¶ä¸­ `i âˆˆ [k, m]`, `j âˆˆ [k, n]`ï¼ˆå› ä¸ºç”¨äº†å‰ç¼€å’Œï¼Œç´¢å¼•åç§»äº†ï¼‰
- å…ˆç®—ä¸»å¯¹è§’çº¿å’Œ `s`
- å†éªŒè¯ï¼š
    - åå¯¹è§’çº¿å’Œ == `s`
    - æ‰€æœ‰ `k` è¡Œçš„å’Œ == `s`
    - æ‰€æœ‰ `k` åˆ—çš„å’Œ == `s`
- ä¸€æ—¦æ»¡è¶³ï¼Œç›´æ¥ `return k`



# ä¸‰ã€ä»£ç æ¼”ç¤º

## Javaä»£ç 

```Java
class Solution {
    public int largestMagicSquare(int[][] grid) {
        int m = grid.length, n = grid[0].length;

        // è¡Œå‰ç¼€å’Œï¼šrowSum[i][j] = ç¬¬ i è¡Œå‰ j ä¸ªå…ƒç´ ä¹‹å’Œ
        int[][] rowSum = new int[m][n + 1];
        // åˆ—å‰ç¼€å’Œï¼šcolSum[i][j] = ç¬¬ j åˆ—å‰ i ä¸ªå…ƒç´ ä¹‹å’Œ
        int[][] colSum = new int[m + 1][n];
        // ä¸»å¯¹è§’çº¿ï¼ˆâ†˜ï¼‰å‰ç¼€å’Œ
        int[][] diagSum = new int[m + 1][n + 1];
        // åå¯¹è§’çº¿ï¼ˆâ†™ï¼‰å‰ç¼€å’Œ
        int[][] antiSum = new int[m + 1][n + 1];

        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                int x = grid[i][j];
                rowSum[i][j + 1] = rowSum[i][j] + x;
                colSum[i + 1][j] = colSum[i][j] + x;
                diagSum[i + 1][j + 1] = diagSum[i][j] + x;
                antiSum[i + 1][j] = antiSum[i][j + 1] + x;
            }
        }

        // ä»å¤§åˆ°å°æšä¸¾è¾¹é•¿ k
        for (int k = Math.min(m, n); k >= 1; k--) {
            for (int i = k; i <= m; i++) {
                for (int j = k; j <= n; j++) {
                    // ä¸»å¯¹è§’çº¿å’Œ
                    int mainDiag = diagSum[i][j] - diagSum[i - k][j - k];
                    // åå¯¹è§’çº¿å’Œ
                    int antiDiag = antiSum[i][j - k] - antiSum[i - k][j];

                    if (antiDiag != mainDiag) continue;

                    int target = mainDiag;
                    boolean valid = true;

                    // æ£€æŸ¥æ¯ä¸€è¡Œ
                    for (int r = i - k; r < i; r++) {
                        if (rowSum[r][j] - rowSum[r][j - k] != target) {
                            valid = false;
                            break;
                        }
                    }
                    if (!valid) continue;

                    // æ£€æŸ¥æ¯ä¸€åˆ—
                    for (int c = j - k; c < j; c++) {
                        if (colSum[i][c] - colSum[i - k][c] != target) {
                            valid = false;
                            break;
                        }
                    }

                    if (valid) return k;
                }
            }
        }

        return 1;
    }
}
```



## Pythonä»£ç 

```Python
class Solution:
    def largestMagicSquare(self, grid: List[List[int]]) -> int:
        m, n = len(grid), len(grid[0])

        # è¡Œå‰ç¼€å’Œï¼šrow_sum[i][j] = ç¬¬ i è¡Œå‰ j ä¸ªå…ƒç´ ä¹‹å’Œ
        row_sum = [[0] * (n + 1) for _ in range(m)]
        # åˆ—å‰ç¼€å’Œï¼šcol_sum[i][j] = ç¬¬ j åˆ—å‰ i ä¸ªå…ƒç´ ä¹‹å’Œ
        col_sum = [[0] * n for _ in range(m + 1)]
        # ä¸»å¯¹è§’çº¿ï¼ˆâ†˜ï¼‰å‰ç¼€å’Œ
        diag_sum = [[0] * (n + 1) for _ in range(m + 1)]
        # åå¯¹è§’çº¿ï¼ˆâ†™ï¼‰å‰ç¼€å’Œ
        anti_sum = [[0] * (n + 1) for _ in range(m + 1)]

        # æ„å»ºå››ä¸ªå‰ç¼€å’Œæ•°ç»„
        for i in range(m):
            for j in range(n):
                x = grid[i][j]
                row_sum[i][j + 1] = row_sum[i][j] + x
                col_sum[i + 1][j] = col_sum[i][j] + x
                diag_sum[i + 1][j + 1] = diag_sum[i][j] + x
                # anti_sum[i + 1][j] æ¥è‡ªå·¦ä¸Šæ–¹ï¼ˆå®é™…æ˜¯å³ä¸Šå¾€å·¦ä¸‹ï¼‰
                anti_sum[i + 1][j] = anti_sum[i][j + 1] + x

        # ä»æœ€å¤§å¯èƒ½çš„ k å¼€å§‹å‘ä¸‹æšä¸¾
        for k in range(min(m, n), 0, -1):
            # æšä¸¾æ‰€æœ‰ k x k å­çŸ©é˜µçš„å³ä¸‹è§’ (i - 1, j - 1)ï¼Œå¯¹åº”å‰ç¼€å’Œç´¢å¼• (i, j)
            for i in range(k, m + 1):
                for j in range(k, n + 1):
                    # ä¸»å¯¹è§’çº¿å’Œï¼šä» (i - k, j - k) åˆ° (i - 1, j - 1)
                    main_diag = diag_sum[i][j] - diag_sum[i - k][j - k]

                    # åå¯¹è§’çº¿å’Œï¼šä» (i - k, j - 1) åˆ° (i - 1, j - k)
                    anti_diag = anti_sum[i][j - k] - anti_sum[i - k][j]

                    if anti_diag != main_diag:
                        continue

                    target = main_diag

                    # æ£€æŸ¥æ¯ä¸€è¡Œçš„å’Œæ˜¯å¦ç­‰äº target
                    valid = True
                    for r in range(i - k, i):
                        if row_sum[r][j] - row_sum[r][j - k] != target:
                            valid = False
                            break
                    if not valid:
                        continue

                    # æ£€æŸ¥æ¯ä¸€åˆ—çš„å’Œæ˜¯å¦ç­‰äº target
                    for c in range(j - k, j):
                        if col_sum[i][c] - col_sum[i - k][c] != target:
                            valid = False
                            break
                    if valid:
                        return k

        return 1  # è‡³å°‘ 1x1 æ€»æ˜¯é­”æ³•æ–¹é˜µ
```

![1895_æœ€å¤§çš„å¹»æ–¹_Java]()

## C++ä»£ç 

```C++
class Solution {
public:
    int largestMagicSquare(vector<vector<int>>& grid) {
        int m = grid.size(), n = grid[0].size();

        // è¡Œå‰ç¼€å’Œï¼šrowSum[i][j] = ç¬¬ i è¡Œå‰ j ä¸ªå…ƒç´ ä¹‹å’Œ
        vector<vector<int>> rowSum(m, vector<int>(n + 1, 0));
        // åˆ—å‰ç¼€å’Œï¼šcolSum[i][j] = ç¬¬ j åˆ—å‰ i ä¸ªå…ƒç´ ä¹‹å’Œ
        vector<vector<int>> colSum(m + 1, vector<int>(n, 0));
        // ä¸»å¯¹è§’çº¿ï¼ˆâ†˜ï¼‰å‰ç¼€å’Œ
        vector<vector<int>> diagSum(m + 1, vector<int>(n + 1, 0));
        // åå¯¹è§’çº¿ï¼ˆâ†™ï¼‰å‰ç¼€å’Œ
        vector<vector<int>> antiSum(m + 1, vector<int>(n + 1, 0));

        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                int x = grid[i][j];
                rowSum[i][j + 1] = rowSum[i][j] + x;
                colSum[i + 1][j] = colSum[i][j] + x;
                diagSum[i + 1][j + 1] = diagSum[i][j] + x;
                antiSum[i + 1][j] = antiSum[i][j + 1] + x;
            }
        }

        // ä»å¤§åˆ°å°æšä¸¾è¾¹é•¿ k
        for (int k = min(m, n); k >= 1; k--) {
            for (int i = k; i <= m; i++) {
                for (int j = k; j <= n; j++) {
                    // ä¸»å¯¹è§’çº¿å’Œ
                    int mainDiag = diagSum[i][j] - diagSum[i - k][j - k];
                    // åå¯¹è§’çº¿å’Œ
                    int antiDiag = antiSum[i][j - k] - antiSum[i - k][j];

                    if (antiDiag != mainDiag) continue;

                    int target = mainDiag;
                    bool valid = true;

                    // æ£€æŸ¥æ¯ä¸€è¡Œ
                    for (int r = i - k; r < i; r++) {
                        if (rowSum[r][j] - rowSum[r][j - k] != target) {
                            valid = false;
                            break;
                        }
                    }
                    if (!valid) continue;

                    // æ£€æŸ¥æ¯ä¸€åˆ—
                    for (int c = j - k; c < j; c++) {
                        if (colSum[i][c] - colSum[i - k][c] != target) {
                            valid = false;
                            break;
                        }
                    }

                    if (valid) return k;
                }
            }
        }

        return 1;
    }
};
```

